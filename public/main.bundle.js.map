{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./js/main.js","webpack:///./src/physics.js","webpack:///./src/utils/chron.js","webpack:///./src/utils/geom.js","webpack:///./src/utils/lcg.js"],"names":["physics","require","geom","chron","LCG","canvas","document","getElementById","ctx","getContext","here","location","tps","TICKS_PER_SECOND","GRID_SIZE","TURN_UNIT","Math","PI","TICK_MS","PLANET_SPIN_SPEED","lcg","inGame","ws","token","self","firing","accel","accelStart","brake","turn_left","turn_right","dead","ships","bullets","turn_left_ramp","turn_right_ramp","lines","planets","tpf","planetAngle","playerCount","leaderboard","rubber","last_partial","send_turn","showDialog","style","display","hideDialog","hideLose","joinGame","wsproto","protocol","replace","port","WebSocket","hostname","pathname","addEventListener","e","msg","data","cmd","args","split","join","window","requestAnimationFrame","frame","nick","value","trim","length","random","toString","send","obj","JSON","parse","abs","posX","velX","posY","velY","name","textContent","score","drawLeaderboard","orient","parseFloat","leaveGame","innerHTML","matching","find","ship","_id","explosion","filter","bullet","close","makeTd","text","td","createElement","makeTableRow","lb","tr","appendChild","leaderBoardTable","newBody","i","min","replaceChild","childNodes","serverTick","stringify","timeMs","inertia","rubberband","getPlanets","gravityShip","gravityBullet","setInterval","partialTick","delta","code","drawShip","scale","cx","width","cy","height","p1","p2","p3","p4","getShipPoints","x1","y1","x2","y2","x3","y3","x4","y4","x0","y0","strokeStyle","beginPath","moveTo","lineTo","stroke","tp1","tp2","tp3","tp4","tp5","getThrusterPoints","x5","y5","xo","yo","font","fillStyle","textAlign","fillText","drawBullet","x","y","arc","fill","drawLine","line","angle","r","alpha","xr","cos","yr","sin","createLine","xv","yv","atan2","hypot","vx","vy","vangle","computePlanetAngle","planet","radius","drawPlanet","lineWidth","reseed","seed","gon","randomInt","randomOffset","x6","y6","push","time","innerWidth","innerHeight","unitSize","MAX_BULLET_DISTANCE","xm","ym","fillRect","gradient","createRadialGradient","RUBBERBAND_BUFFER","addColorStop","rect","dx","dy","MAX_SHIP_VELOCITY","MIN_SHIP_VELOCITY","LATCH_VELOCITY","BULLET_VELOCITY","BRAKE_MUL","INERTIA_MUL","DELAY_BETWEEN_BULLETS_MS","PLANET_SEED","PLANET_CHUNK_SIZE","getAccelMul","accelTimeMs","checkMinVelocity","v","checkMaxVelocity","getPlanetsForChunk","xb","yb","floor","accelMul","d","d2","m","getRubberbandRadius","pow","max","distCenter","maxRadius","baseX","baseY","module","exports","Date","getTime","pointInTriangle","p","xp","yp","c1","c2","c3","wrapRadianAngle","rotatePoint","s","c","rotatePointOffset","getRealShipPoints","points","getCollisionPoints","LCG_A","LCG_C","Generator","constructor","val"],"mappings":"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","file":"main.bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./js/main.js\");\n","const physics = require('../src/physics')\nconst geom = require('../src/utils/geom')\nconst chron = require('../src/utils/chron')\nconst LCG = require('../src/utils/lcg')\nconst canvas = document.getElementById('screen')\nconst ctx = canvas.getContext('2d')\nconst here = document.location\nconst tps = physics.TICKS_PER_SECOND\nconst GRID_SIZE = 10\nconst TURN_UNIT = 2 * Math.PI / tps\nconst TICK_MS = 1000 / tps\nconst PLANET_SPIN_SPEED = 0.02\n\nlet lcg = new LCG(0)\nlet inGame = false\nlet ws = null\nlet token = null\nlet self = null\nlet firing = false\nlet accel = false\nlet accelStart = 0\nlet brake = false\nlet turn_left = false\nlet turn_right = false\nlet dead = false\nlet ships = []\nlet bullets = []\nlet turn_left_ramp = 0\nlet turn_right_ramp = 0\nlet lines = []\nlet planets = []\nlet tpf = 1\nlet planetAngle = 0\nlet playerCount = 1\nlet leaderboard = []\nlet rubber = 150\n\nlet last_partial = null\nlet send_turn = false\n\nconst showDialog = () => {\n  document.getElementById('dialog').style.display = 'block'\n  document.getElementById('stats').style.display = 'none'\n}\n\nconst hideDialog = () => {\n  document.getElementById('dialog').style.display = 'none'\n  document.getElementById('stats').style.display = 'block'\n}\n\nconst hideLose = () => {\n  document.getElementById('defeat').style.display = 'none'\n  document.getElementById('defeatcrash').style.display = 'none'\n  document.getElementById('defeatplanet').style.display = 'none'\n  document.getElementById('defeatname').style.display = 'none'\n  document.getElementById('disconnected').style.display = 'none'\n}\nhideLose()\n\nconst joinGame = () => {\n  if (!inGame) {\n    hideDialog()\n    let wsproto = here.protocol.replace('http', 'ws')\n    let port = here.port\n    if (port) {\n      port = `:${port}`\n    }\n    ws = new WebSocket(`${wsproto}//${here.hostname}${port}${here.pathname}`)\n    inGame = true\n\n    ws.addEventListener('message', (e) => {\n      const msg = e.data\n\n      let [cmd, ...args] = msg.split(' ')\n      args = args.join(' ')\n\n      if (cmd === 'your_token') {\n        if (token == null) {\n          window.requestAnimationFrame(frame)\n        }\n        token = args\n        let nick = document.getElementById('nick').value.trim()\n        if (nick.length < 1) {\n          nick = ((100000000 * Math.random()) | 0).toString()\n        }\n        send(`nick ${nick}`)\n      } else if (cmd === 'you') {\n        const obj = JSON.parse(args)\n        if (self === null) {\n          self = obj\n        } else {\n          if (Math.abs(obj.posX - self.posX) > 0.3) {\n            self.posX = (self.posX + obj.posX) / 2\n            self.velX = (self.velX + obj.velX) / 2\n          }\n          if (Math.abs(obj.posY - self.posY) > 0.3) {\n            self.posY = (self.posY + obj.posY) / 2\n            self.velY = (self.velY + obj.velY) / 2\n          }\n          if (Math.abs(obj.velX - self.velX) > 0.2) {\n            self.velX = obj.velX\n          }\n          if (Math.abs(obj.velY - self.velY) > 0.2) {\n            self.posY = obj.posY\n          }\n          if (!accel && obj.accel !== null) {\n            send_turn = true\n          } else if (accel && obj.accel === null) {\n            send_turn = true\n          } else if (!brake && obj.brake !== null) {\n            send_turn = true\n          } else if (brake && obj.brake === null) {\n            send_turn = true\n          }\n          self.name = obj.name\n          document.getElementById('yourscore').textContent = self.score = obj.score\n        }\n      } else if (cmd === 'players') {\n        [playerCount, rubber] = JSON.parse(args)\n        document.getElementById('playerCountNum').textContent = playerCount\n      } else if (cmd === 'leaderboard') {\n        leaderboard = JSON.parse(args)\n        drawLeaderboard()\n      } else if (cmd === 'set_orient') {\n        self.orient = parseFloat(args)\n      } else if (cmd === 'unrecognized') {\n        leaveGame()\n      } else if (cmd === 'nearby') {\n        [ships, bullets] = JSON.parse(args)\n      } else if (cmd === 'defeated') {\n        hideLose()\n        leaveGame()\n        document.getElementById('defeat').style.display = 'inline'\n        document.getElementById('defeatname').style.display = 'inline'\n        document.getElementById('defeatname').innerHTML = args\n      } else if (cmd === 'defeated_collision') {\n        hideLose()\n        leaveGame()\n        document.getElementById('defeatcrash').style.display = 'inline'\n        document.getElementById('defeatname').style.display = 'inline'\n        document.getElementById('defeatname').innerHTML = args\n      } else if (cmd === 'defeated_planet') {\n        hideLose()\n        leaveGame()\n        document.getElementById('defeatplanet').style.display = 'inline'\n      } else if (cmd === 'kill_ship') {\n        const matching = ships.find(ship => ship._id === args)\n        if (matching !== null) {\n          explosion(matching)\n        }\n        ships = ships.filter(ship => ship._id !== args)\n      } else if (cmd === 'remove_ship') {\n        ships = ships.filter(ship => ship._id !== args)\n      } else if (cmd === 'remove_bullet') {\n        bullets = bullets.filter(bullet => bullet._id !== args)\n      }\n    })\n    \n    ws.addEventListener('open', () => {\n      dead = false\n      ws.send('join')\n    })\n    \n    ws.addEventListener('close', () => {\n      if (!dead) {\n        hideLose()\n        document.getElementById('disconnected').style.display = 'inline'\n        leaveGame()\n      }\n      dead = true\n    })\n  }\n}\n\nconst leaveGame = () => {\n  if (ws !== null) {\n    ws.close()\n  }\n  dead = true\n  self = null\n  ws = null\n  token = null\n  inGame = false\n  accel = false\n  brake = false\n  turn_left = false\n  turn_right = false\n  firing = false\n  showDialog()\n}\n\nconst send = (msg) => {\n  if (token) {\n    ws.send(`${token} ${msg}`)\n  }\n}\n\nconst makeTd = (text) => {\n  const td = document.createElement('td')\n  td.textContent = text\n  return td\n}\n\nconst makeTableRow = (lb) => {\n  const tr = document.createElement('tr')\n  tr.appendChild(makeTd(lb[0]))\n  tr.appendChild(makeTd(lb[1]))\n  return tr\n}\n\nconst drawLeaderboard = () => {\n  const leaderBoardTable = document.getElementById('leaderboard')\n  const newBody = document.createElement('tbody')\n  \n  for (let i = 0; i < Math.min(10, leaderboard.length); ++i) {\n    newBody.appendChild(makeTableRow(leaderboard[i]))\n  }\n\n  leaderBoardTable.replaceChild(newBody, leaderBoardTable.childNodes[0])\n}\n\nconst serverTick = () => {\n  if (!ws || !self) {\n    return\n  }\n\n  if (send_turn) {\n    send(`control ${JSON.stringify([self.orient, accel, brake])}`)\n    send_turn = false\n  }\n  \n  if (firing) {\n    send('fire')\n  }\n  \n  if (accel) {\n    physics.accel(self, chron.timeMs() - accelStart)\n  }\n  if (brake) {\n    physics.brake(self)\n  }\n  physics.inertia(self)\n  physics.rubberband(self, rubber)\n  planets = physics.getPlanets(self.posX, self.posY)\n  physics.gravityShip(self, planets)\n\n  for (const bullet of bullets) {\n    physics.gravityBullet(bullet, physics.getPlanets(bullet.posX, bullet.posY))\n  }\n}\nsetInterval(serverTick, TICK_MS)\n\nconst partialTick = (delta) => {\n  tpf = 1.0 * delta / TICK_MS\n\n  // turning\n  if (turn_left && !turn_right) {\n    self.orient -= turn_left_ramp * TURN_UNIT * tpf\n    turn_left_ramp = Math.min(1, turn_left_ramp + tpf * 0.1)\n    accelStart = chron.timeMs()\n    send_turn = true\n  } else if (turn_right && !turn_left) {\n    self.orient += turn_right_ramp * TURN_UNIT * tpf\n    turn_right_ramp = Math.min(1, turn_right_ramp + tpf * 0.1)\n    accelStart = chron.timeMs()\n    send_turn = true\n  }\n  \n  // interpolate\n  self.posX += tpf * self.velX\n  self.posY += tpf * self.velY\n\n  for (const ship of ships) {\n    ship.posX += tpf * ship.velX\n    ship.posY += tpf * ship.velY\n  }\n  for (const bullet of bullets) {\n    bullet.posX += tpf * bullet.velX\n    bullet.posY += tpf * bullet.velY\n  }\n}\n\nwindow.addEventListener('keydown', (e) => {\n  if (!token || dead) {\n    return\n  }\n\n  if (e.code == 'KeyW') {\n    accel = true\n    self.accel = accelStart = chron.timeMs()\n    send_turn = true\n  } else if (e.code == 'KeyS') {\n    brake = true\n    send_turn = true\n  } else if (e.code == 'KeyA') {\n    turn_left = true\n  } else if (e.code == 'KeyD') {\n    turn_right = true\n  } else if (e.code == 'Space') {\n    firing = true\n  }\n}, true)\n\nwindow.addEventListener('keyup', (e) => {\n  if (!token || dead) {\n    return\n  }\n\n  if (e.code == 'KeyW') {\n    accel = false\n    self.accel = null\n    send_turn = true\n  } else if (e.code == 'KeyS') {\n    brake = false\n    send_turn = true\n  } else if (e.code == 'KeyA') {\n    turn_left_ramp = 0\n    turn_left = false\n  } else if (e.code == 'KeyD') {\n    turn_right_ramp = 0\n    turn_right = false\n  } else if (e.code == 'Space') {\n    firing = false\n  }\n}, true)\n\nwindow.addEventListener('blur', () => {\n  if (!token || dead) {\n    return\n  }\n\n  accel = false\n  self.accel = null\n  brake = false\n  turn_left = false\n  turn_right = false\n  firing = false\n  send_turn = true\n}, true)\n\nwindow.addEventListener('beforeupload', () => {\n  send('disconnect')\n}, true)\n\nconst drawShip = (ship, scale) => {\n  const cx = ctx.canvas.width / 2\n  const cy = ctx.canvas.height / 2\n\n  const [p1, p2, p3, p4] = geom.getShipPoints(ship)\n  let [x1, y1] = p1\n  let [x2, y2] = p2\n  let [x3, y3] = p3\n  let [x4, y4] = p4\n  let [x0, y0] = [0, 0]\n\n  x0 = cx + (self.posX - ship.posX) * scale\n  x1 = cx + (self.posX - ship.posX + x1) * scale\n  x2 = cx + (self.posX - ship.posX + x2) * scale\n  x3 = cx + (self.posX - ship.posX + x3) * scale\n  x4 = cx + (self.posX - ship.posX + x4) * scale\n\n  y0 = cy + (self.posY - ship.posY) * scale\n  y1 = cy + (self.posY - ship.posY + y1) * scale\n  y2 = cy + (self.posY - ship.posY + y2) * scale\n  y3 = cy + (self.posY - ship.posY + y3) * scale\n  y4 = cy + (self.posY - ship.posY + y4) * scale\n\n  ctx.strokeStyle = '#fff'\n  ctx.beginPath()\n  ctx.moveTo(x1, y1)\n  ctx.lineTo(x2, y2)\n  ctx.lineTo(x3, y3)\n  ctx.lineTo(x4, y4)\n  ctx.lineTo(x1, y1)\n  ctx.stroke()\n\n  if (ship.accel) {\n    const [tp1, tp2, tp3, tp4, tp5] = geom.getThrusterPoints(ship)\n    let [x1, y1] = tp1\n    let [x2, y2] = tp2\n    let [x3, y3] = tp3\n    let [x4, y4] = tp4\n    let [x5, y5] = tp5\n\n    let xo = (Math.random() - 0.5) * scale / 4\n    let yo = (Math.random() - 0.5) * scale / 4\n\n    x1 = cx + (self.posX - ship.posX + x1) * scale\n    x2 = cx + (self.posX - ship.posX + x2) * scale\n    x3 = cx + (self.posX - ship.posX + x3) * scale\n    x4 = cx + (self.posX - ship.posX + x4) * scale\n    x5 = cx + (self.posX - ship.posX + x5) * scale\n  \n    y1 = cy + (self.posY - ship.posY + y1) * scale\n    y2 = cy + (self.posY - ship.posY + y2) * scale\n    y3 = cy + (self.posY - ship.posY + y3) * scale\n    y4 = cy + (self.posY - ship.posY + y4) * scale\n    y5 = cy + (self.posY - ship.posY + y5) * scale\n\n    x3 += xo\n    y3 += yo\n    x5 += xo / 2\n    y5 += yo / 2  \n\n    ctx.strokeStyle = '#888'\n    ctx.beginPath()\n    ctx.moveTo(x1, y1)\n    ctx.lineTo(x2, y2)\n    ctx.lineTo(x3, y3)\n    ctx.lineTo(x4, y4)\n    ctx.lineTo(x1, y1)\n    ctx.lineTo(x5, y5)\n    ctx.stroke()\n  }\n\n  ctx.font = '18px monospace'\n  ctx.fillStyle = 'rgba(255,255,255,0.75)'\n  ctx.textAlign = 'center'\n  ctx.fillText(ship.name, x0, y0 - 2.75 * scale)\n}\n\nconst drawBullet = (bullet, scale) => {\n  const cx = ctx.canvas.width / 2\n  const cy = ctx.canvas.height / 2\n\n  const x = cx + (self.posX - bullet.posX) * scale\n  const y = cy + (self.posY - bullet.posY) * scale\n\n  ctx.fillStyle = '#fff'\n  ctx.beginPath()\n  ctx.arc(x, y, 0.2 * scale, 0, 2 * Math.PI)\n  ctx.fill()\n}\n\nconst drawLine = (line, scale) => {\n  const { x, y, angle, r, alpha } = line\n  const cx = ctx.canvas.width / 2\n  const cy = ctx.canvas.height / 2\n\n  const x1 = cx + scale * (x + self.posX - line.xr - r * Math.cos(angle))\n  const y1 = cy + scale * (y + self.posY - line.yr - r * Math.sin(angle))\n  const x2 = cx + scale * (x + self.posX - line.xr + r * Math.cos(angle))\n  const y2 = cy + scale * (y + self.posY - line.yr + r * Math.sin(angle))\n\n  ctx.strokeStyle = `rgba(192,192,192,${alpha * 0.01})` \n  ctx.beginPath()\n  ctx.moveTo(x1, y1)\n  ctx.lineTo(x2, y2)\n  ctx.stroke()\n}\n\nconst createLine = (x1, y1, x2, y2, xr, yr, xv, yv) => {\n  const [x, y] = [(x1 + x2) / 2, (y1 + y2) / 2]\n  const angle = Math.atan2(x2 - x1, y2 - y1)\n  const r = Math.hypot(x2 - x1, y2 - y1) / 2\n  const vx = -0.05 + 0.1 * Math.random() - xv * tpf\n  const vy = -0.05 + 0.1 * Math.random() - yv * tpf\n  const vangle = -0.1 + 0.2 * Math.random()\n\n  // x, y, xr, yr, angle, r, alpha, vx, vy, vangle\n  return { x, y, xr, yr, angle, alpha: 100, r, vx, vy, vangle }\n}\n\nconst computePlanetAngle = (planet, angle, scale, cx, cy) => {\n  const x = planet.x + Math.sin(angle) * planet.radius\n  const y = planet.y + Math.cos(angle) * planet.radius\n\n  return [cx + (self.posX - x) * scale, cy + (self.posY - y) * scale]\n}\n\nconst drawPlanet = (planet, scale) => {\n  const cx = ctx.canvas.width / 2\n  const cy = ctx.canvas.height / 2\n  ctx.strokeStyle = '#fff'\n  ctx.lineWidth = 1\n\n  lcg.reseed(planet.seed)\n  const gon = Math.abs(lcg.randomInt()) % 24 + 14\n\n  let angle = lcg.randomOffset() * Math.PI * 2 + planetAngle * \n    (2 * (lcg.randomInt() & 1) - 1)\n  let [x, y] = computePlanetAngle(planet, angle, scale, cx, cy)\n\n  ctx.beginPath()\n  ctx.moveTo(x, y)\n  for (let i = 0; i < gon; ++i) {\n    angle += (2 * Math.PI) / gon;\n    [x, y] = computePlanetAngle(planet, angle, scale, cx, cy)\n    ctx.lineTo(x, y)\n  }\n  ctx.stroke()\n}\n\nconst explosion = (ship) => {\n  const [p1, p2, p3, p4] = geom.getShipPoints(ship)\n  let [x1, y1] = p1\n  let [x2, y2] = p2\n  let [x3, y3] = p3\n  let [x4, y4] = p4\n\n  let [x5, y5] = [(x1 + x2) / 2, (y1 + y2) / 2]\n  let [x6, y6] = [(x1 + x4) / 2, (y1 + y4) / 2]\n\n  lines.push(createLine(x1, y1, x5, y5, \n    ship.posX, ship.posY, ship.velX, ship.velY))\n  lines.push(createLine(x5, y5, x2, y2, \n    ship.posX, ship.posY, ship.velX, ship.velY))\n  lines.push(createLine(x2, y2, x3, y3, \n    ship.posX, ship.posY, ship.velX, ship.velY))\n  lines.push(createLine(x3, y3, x4, y4, \n    ship.posX, ship.posY, ship.velX, ship.velY))\n  lines.push(createLine(x4, y4, x6, y6, \n    ship.posX, ship.posY, ship.velX, ship.velY))\n  lines.push(createLine(x6, y6, x1, y1, \n    ship.posX, ship.posY, ship.velX, ship.velY))\n}\n\nconst frame = (time) => {\n  ctx.canvas.width = window.innerWidth\n  ctx.canvas.height = window.innerHeight\n  const cx = ctx.canvas.width / 2\n  const cy = ctx.canvas.height / 2\n  const unitSize = Math.min(ctx.canvas.width, ctx.canvas.height) * (1 \n    / physics.MAX_BULLET_DISTANCE)\n\n  if (!token || !self) {\n    return\n  }\n\n  if (last_partial != null) {\n    const delta = time - last_partial\n    partialTick(delta)\n  }\n  last_partial = time\n\n  const xm = ((self.posX % GRID_SIZE) + GRID_SIZE) % GRID_SIZE\n  const ym = ((self.posY % GRID_SIZE) + GRID_SIZE) % GRID_SIZE\n\n  ctx.fillStyle = '#000'\n  ctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height)\n\n  const gradient = ctx.createRadialGradient(cx + self.posX * unitSize,\n    cy + self.posY * unitSize,\n    (rubber - 1) * unitSize,\n    cx + self.posX * unitSize,\n    cy + self.posY * unitSize,\n    (rubber + physics.RUBBERBAND_BUFFER - 1) * unitSize)\n  gradient.addColorStop(0, 'rgba(255,0,0,0)')\n  gradient.addColorStop(1, 'rgba(255,0,0,0.25)')\n  // draw mask\n  ctx.beginPath()\n  ctx.arc(cx + self.posX * unitSize, cy + self.posY * unitSize, \n    rubber * unitSize, 0, 2 * Math.PI)\n  ctx.rect(ctx.canvas.width, 0, -ctx.canvas.width, ctx.canvas.height)\n  ctx.fillStyle = gradient\n  ctx.fill()\n\n  // draw grid\n  ctx.lineWidth = 1\n  ctx.strokeStyle = '#333'\n  for (let x = xm * unitSize; \n    x < ctx.canvas.width; \n    x += GRID_SIZE * unitSize) {\n    ctx.beginPath()\n    const dx = x | 0 + 0.5\n    ctx.moveTo(dx, 0)\n    ctx.lineTo(dx, ctx.canvas.height)\n    ctx.stroke()\n  }\n  for (let y = ym * unitSize; \n    y < ctx.canvas.height;\n    y += GRID_SIZE * unitSize) {\n    ctx.beginPath()\n    const dy = y | 0 + 0.5\n    ctx.moveTo(0, dy)\n    ctx.lineTo(ctx.canvas.width, dy)\n    ctx.stroke()\n  }\n\n  // draw player ship\n  ctx.lineWidth = 1.5\n  drawShip(self, unitSize)\n\n  // draw ships\n  ctx.lineWidth = 1\n  for (const ship of ships) {\n    drawShip(ship, unitSize)\n  }\n\n  // draw bullets\n  for (const bullet of bullets) {\n    drawBullet(bullet, unitSize)\n  }\n\n  // draw planets\n  for (const planet of planets) {\n    drawPlanet(planet, unitSize)\n  }\n\n  // draw lines\n  for (const line of lines) {\n    drawLine(line, unitSize)\n\n    line.x += line.vx\n    line.y += line.vy\n    line.angle += line.vangle\n    line.vx *= 0.99\n    line.vy *= 0.99\n    line.vangle *= 0.99\n    line.alpha -= 1\n  }\n  lines = lines.filter(line => line.alpha > 0)\n\n  planetAngle += PLANET_SPIN_SPEED\n  planetAngle %= 2 * Math.PI\n\n  window.requestAnimationFrame(frame)\n}\n\ndocument.getElementById('btnplay').addEventListener('click', () => joinGame())\n\nleaveGame()\nshowDialog()\n","const TICKS_PER_SECOND = 24\nconst MAX_SHIP_VELOCITY = 32 / TICKS_PER_SECOND\nconst MIN_SHIP_VELOCITY = 0.01\nconst LATCH_VELOCITY = 0.15\nconst BULLET_VELOCITY = MAX_SHIP_VELOCITY * 2\nconst BRAKE_MUL = (MIN_SHIP_VELOCITY / MAX_SHIP_VELOCITY) ** (1 / (TICKS_PER_SECOND * 2.5))\nconst INERTIA_MUL = (MIN_SHIP_VELOCITY / MAX_SHIP_VELOCITY) ** (1 / (TICKS_PER_SECOND * 90))\nconst MAX_BULLET_DISTANCE = 56\nconst DELAY_BETWEEN_BULLETS_MS = 250\nconst RUBBERBAND_BUFFER = 80\nconst PLANET_SEED = 1340985549\nconst LCG = require('./utils/lcg')\nconst PLANET_CHUNK_SIZE = MAX_BULLET_DISTANCE * 2 + 1\n\nconst getAccelMul = (accelTimeMs) => { // time in milliseconds\n  return 0.05 + 0.000025 * accelTimeMs\n}\n\nconst checkMinVelocity = (ship) => {\n  const v = Math.hypot(ship.velX, ship.velY)\n  if (v <= MIN_SHIP_VELOCITY) {\n    ship.velX = 0\n    ship.velY = 0\n  }\n}\n\nconst checkMaxVelocity = (ship) => {\n  const v = Math.hypot(ship.velX, ship.velY)\n  if (v > MAX_SHIP_VELOCITY) {\n    ship.velX *= MAX_SHIP_VELOCITY / v\n    ship.velY *= MAX_SHIP_VELOCITY / v\n  }\n}\n\n// planet: x, y, radius, seed\nconst getPlanetsForChunk = (cx, cy) => {\n  const r = PLANET_CHUNK_SIZE\n  const lcg = new LCG((PLANET_SEED ^ (cx * 1173320513) ^ (cy * 891693747)) & 0xFFFFFFFF)\n  const xb = (cx + 0.5) * r\n  const yb = (cy + 0.5) * r\n  \n  const xo = lcg.randomOffset() * (r / 4)\n  const yo = lcg.randomOffset() * (r / 4)\n  const radius = (r / 24) + (r / 8) * lcg.random()\n  const seed = lcg.randomInt()\n  return [ { x: xb + xo, y: yb + yo, radius, seed } ]\n}\n\nconst getPlanets = (x, y) => {\n  const x1 = Math.floor((x - MAX_BULLET_DISTANCE) / PLANET_CHUNK_SIZE)\n  const y1 = Math.floor((y - MAX_BULLET_DISTANCE) / PLANET_CHUNK_SIZE)\n  const x2 = Math.floor((x + MAX_BULLET_DISTANCE) / PLANET_CHUNK_SIZE)\n  const y2 = Math.floor((y + MAX_BULLET_DISTANCE) / PLANET_CHUNK_SIZE)\n  if (x1 == x2 && y1 == y2) {\n    return getPlanetsForChunk(x1, y1)\n  } else if (x1 == x2) {\n    return [...getPlanetsForChunk(x1, y1), ...getPlanetsForChunk(x1, y2)]\n  } else if (y1 == y2) {\n    return [...getPlanetsForChunk(x1, y1), ...getPlanetsForChunk(x2, y1)]\n  } else {\n    return [...getPlanetsForChunk(x1, y1), ...getPlanetsForChunk(x2, y1),\n      ...getPlanetsForChunk(x1, y2), ...getPlanetsForChunk(x2, y2)]\n  }\n}\n\nconst accel = (ship, accelTimeMs) => {\n  const accelMul = getAccelMul(accelTimeMs)\n  ship.velX += accelMul * Math.sin(-ship.orient)\n  ship.velY += accelMul * Math.cos(-ship.orient)\n  checkMaxVelocity(ship)\n}\n\nconst inertia = (ship) => {\n  ship.velX *= INERTIA_MUL\n  ship.velY *= INERTIA_MUL\n  checkMinVelocity(ship)\n}\n\nconst brake = (ship) => {\n  ship.velX *= BRAKE_MUL\n  ship.velY *= BRAKE_MUL\n  checkMinVelocity(ship)\n}\n\nconst gravityBullet = (bullet, planets) => {\n  for (const planet of planets) {\n    const d = Math.hypot(bullet.posX - planet.x, bullet.posY - planet.y)\n    if (d > (planet.radius + 1.2) && d < planet.radius * 2.5) {\n      const dx = planet.x - bullet.posX\n      const dy = planet.y - bullet.posY\n      const d2 = Math.hypot(dx, dy)\n      const m = (BULLET_VELOCITY * (planet.radius ** 1.25)) / (d2 * d2)\n      bullet.velX += (m / d2) * dx\n      bullet.velY += (m / d2) * dy\n    }\n  }\n  const d = Math.hypot(bullet.velX, bullet.velY)\n  bullet.velX *= BULLET_VELOCITY / d\n  bullet.velY *= BULLET_VELOCITY / d\n}\n\nconst gravityShip = (ship, planets) => {\n  for (const planet of planets) {\n    const d = Math.hypot(ship.posX - planet.x, ship.posY - planet.y)\n    if (d > (planet.radius + 1.2) && d < planet.radius * 2.5) {\n      const dx = planet.x - ship.posX\n      const dy = planet.y - ship.posY\n      const d2 = Math.hypot(dx, dy)\n      const m = (MAX_SHIP_VELOCITY / 24 * (planet.radius ** 1.5)) / (d2 * d2)\n      ship.velX += (m / d2) * dx\n      ship.velY += (m / d2) * dy\n    }\n  }\n  checkMaxVelocity(ship)\n}\n\nconst getRubberbandRadius = (playerCount) => {\n  return 100 * Math.pow(Math.max(playerCount, 1), 0.4)\n}\n\nconst rubberband = (ship, radius) => {\n  const distCenter = Math.hypot(ship.posX, ship.posY)\n  if (distCenter > radius) {\n    const maxRadius = radius + RUBBERBAND_BUFFER\n    const baseX = -ship.posX / Math.hypot(ship.posX, ship.posY)\n    const baseY = -ship.posY / Math.hypot(ship.posX, ship.posY)\n    if (distCenter > maxRadius) {\n      ship.velX = ship.velY = 0\n    }\n    ship.velX += baseX * 0.25 * MAX_SHIP_VELOCITY *\n      ((distCenter - radius) / (maxRadius - radius)) ** 4\n    ship.velY += baseY * 0.25 * MAX_SHIP_VELOCITY *\n      ((distCenter - radius) / (maxRadius - radius)) ** 4\n    checkMaxVelocity(ship)\n  }\n}\n\nmodule.exports = {\n  TICKS_PER_SECOND, \n  MAX_SHIP_VELOCITY,\n  BULLET_VELOCITY,\n  LATCH_VELOCITY,\n  MAX_BULLET_DISTANCE,\n  DELAY_BETWEEN_BULLETS_MS,\n  RUBBERBAND_BUFFER,\n  accel,\n  inertia,\n  brake,\n  gravityBullet,\n  gravityShip,\n  rubberband,\n  getPlanets,\n  getRubberbandRadius }\n","const timeMs = () => new Date().getTime()\n\nmodule.exports = { timeMs }\n","const pointInTriangle = (p1, p2, p3, p) => {\n  const [x1, y1] = p1\n  const [x2, y2] = p2\n  const [x3, y3] = p3\n  const [xp, yp] = p\n\n  const c1 = ((y2 - y3) * (xp - x3) + (x3 - x2) * (yp - y3)) \n           / ((y2 - y3) * (x1 - x3) + (x3 - x2) * (y1 - y3))\n  const c2 = ((y3 - y1) * (xp - x3) + (x1 - x3) * (yp - y3)) \n           / ((y2 - y3) * (x1 - x3) + (x3 - x2) * (y1 - y3))\n  const c3 = 1 - c1 - c2\n  return c1 > 0 && c2 > 0 && c3 > 0\n}\n\nconst wrapRadianAngle = (angle) => {\n  return (angle + Math.PI) % (2 * Math.PI) - Math.PI\n}\n\nconst rotatePoint = (s, c, x, y) => [x * c - y * s, x * s + y * c]\n\nconst rotatePointOffset = (s, c, x, y, xo, yo) => \n  [xo + x * c - y * s, yo + x * s + y * c]\n\nconst getShipPoints = (ship) => {\n  if (!ship) {\n    return []\n  }\n\n  const s = Math.sin(ship.orient)\n  const c = Math.cos(ship.orient)\n\n  return [\n    rotatePoint(s, c,  0   , +1   ),\n    rotatePoint(s, c, +1   , +1.5 ),\n    rotatePoint(s, c,  0   , -1   ),\n    rotatePoint(s, c, -1   , +1.5 )\n  ]\n}\n\nconst getRealShipPoints = (ship) => {\n  if (!ship) {\n    return []\n  }\n\n  const points = getShipPoints(ship)\n  return [\n    [points[0][0] + ship.posX, points[0][1] + ship.posY],\n    [points[1][0] + ship.posX, points[1][1] + ship.posY],\n    [points[2][0] + ship.posX, points[2][1] + ship.posY],\n    [points[3][0] + ship.posX, points[3][1] + ship.posY]\n  ]\n}\n\nconst getCollisionPoints = (ship) => {\n  if (!ship) {\n    return []\n  }\n\n  const s = Math.sin(ship.orient)\n  const c = Math.cos(ship.orient)\n  \n  return [\n    rotatePointOffset(s, c,  0   , 0    , ship.posX, ship.posY),\n    rotatePointOffset(s, c, +0.5 , +0.75, ship.posX, ship.posY),\n    rotatePointOffset(s, c, -0.5 , +0.75, ship.posX, ship.posY)\n  ]\n}\n\nconst getThrusterPoints = (ship) => {\n  if (!ship) {\n    return []\n  }\n\n  const s = Math.sin(ship.orient)\n  const c = Math.cos(ship.orient)\n\n  return [\n    rotatePoint(s, c,  0   , +1   ),\n    rotatePoint(s, c, +0.5 , +1.25),\n    rotatePoint(s, c,  0   , +2.5 ),\n    rotatePoint(s, c, -0.5 , +1.25),\n    rotatePoint(s, c,  0   , +1.75),\n  ]\n}\n\nmodule.exports = { \n  pointInTriangle, \n  wrapRadianAngle, \n  getShipPoints, \n  getRealShipPoints, \n  getCollisionPoints,\n  getThrusterPoints }\n","const LCG_A = 535426113\nconst LCG_C = 2258250855\n\nclass Generator {\n  constructor(seed) {\n    this.seed = seed & 0xFFFFFFFF\n  }\n\n  reseed(seed) {\n    this.seed = seed & 0xFFFFFFFF\n  }\n\n  randomInt() {\n    const val = this.seed\n    this.seed = (LCG_A * val + LCG_C) & 0xFFFFFFFF\n    return val\n  }\n\n  random() {\n    let v = this.randomInt() / (2.0 ** 32)\n    if (v < 0) {\n      v += 1\n    }\n    return v\n  }\n\n  randomOffset() {\n    return 2 * this.random() - 1\n  }\n}\n\nmodule.exports = Generator\n"],"sourceRoot":""}