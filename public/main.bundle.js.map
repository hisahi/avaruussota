{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./js/main.js","webpack:///./src/physics.js","webpack:///./src/utils/chron.js","webpack:///./src/utils/geom.js"],"names":["physics","require","geom","chron","canvas","document","getElementById","ctx","getContext","here","location","ws","WebSocket","hostname","port","pathname","tps","TICKS_PER_SECOND","GRID_SIZE","TURN_UNIT","Math","PI","token","self","firing","accel","accelStart","brake","turn_left","turn_right","dead","ships","bullets","turn_left_ramp","turn_right_ramp","send","msg","setInterval","new_angle","orient","min","timeMs","inertia","posX","velX","posY","velY","window","addEventListener","e","code","drawShip","ship","scale","cx","width","cy","height","p1","p2","p3","p4","getShipPoints","x1","y1","x2","y2","x3","y3","x4","y4","strokeStyle","beginPath","moveTo","lineTo","stroke","tp1","tp2","tp3","tp4","tp5","getThrusterPoints","x5","y5","xo","random","yo","drawBullet","bullet","x","y","fillStyle","arc","fill","frame","innerWidth","innerHeight","unitSize","MAX_BULLET_DISTANCE","xm","ym","fillRect","lineWidth","dx","dy","requestAnimationFrame","console","log","data","cmd","args","split","join","obj","JSON","parse","abs","_id","filter","MAX_SHIP_VELOCITY","MIN_SHIP_VELOCITY","BULLET_VELOCITY","BRAKE_MUL","INERTIA_MUL","DELAY_BETWEEN_BULLETS_MS","getAccelMul","accelTimeMs","checkMinVelocity","v","hypot","checkMaxVelocity","accelMul","sin","cos","module","exports","Date","getTime","pointInTriangle","p","xp","yp","c1","c2","c3","wrapRadianAngle","angle","rotatePoint","s","c"],"mappings":"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","file":"main.bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./js/main.js\");\n","const physics = require('../src/physics')\nconst geom = require('../src/utils/geom')\nconst chron = require('../src/utils/chron')\nconst canvas = document.getElementById('screen')\nconst ctx = canvas.getContext('2d')\nconst here = document.location\nconst ws = new WebSocket(`ws://${here.hostname}:${here.port}${here.pathname}`)\nconst tps = physics.TICKS_PER_SECOND\nconst GRID_SIZE = 10\nconst TURN_UNIT = 2 * Math.PI / tps\n\nlet token = null\nlet self = null\nlet firing = false\nlet accel = false\nlet accelStart = 0\nlet brake = false\nlet turn_left = false\nlet turn_right = false\nlet dead = false\nlet ships = []\nlet bullets = []\nlet turn_left_ramp = 0\nlet turn_right_ramp = 0\n\nconst send = (msg) => {\n  if (token) {\n    ws.send(`${token} ${msg}`)\n  }\n}\n\nsetInterval(() => {\n  let new_angle = self.orient\n\n  if (turn_left && !turn_right) {\n    new_angle -= turn_left_ramp * TURN_UNIT\n    turn_left_ramp = Math.min(1, turn_left_ramp + 0.1)\n    accelStart = chron.timeMs()\n  } else if (turn_right && !turn_left) {\n    new_angle += turn_right_ramp * TURN_UNIT\n    turn_right_ramp = Math.min(1, turn_right_ramp + 0.1)\n    accelStart = chron.timeMs()\n  }\n\n  if (new_angle != self.orient) {\n    self.orient = new_angle\n    send(`turn ${new_angle}`)\n  }\n\n  if (accel) {\n    physics.accel(self, chron.timeMs() - accelStart)\n  }\n  if (brake) {\n    physics.brake(self)\n  }\n  physics.inertia(self)\n  self.posX += self.velX\n  self.posY += self.velY\n}, 1000 / tps)\n\nwindow.addEventListener('keydown', (e) => {\n  if (!token || dead) {\n    return\n  }\n\n  if (e.code == 'KeyW') {\n    accel = true\n    self.accel = accelStart = chron.timeMs()\n    send('accel_on')\n  } else if (e.code == 'KeyS') {\n    brake = true\n    send('brake_on')\n  } else if (e.code == 'KeyA') {\n    turn_left = true\n  } else if (e.code == 'KeyD') {\n    turn_right = true\n  } else if (e.code == 'Space') {\n    firing = true\n  }\n}, true)\n\nwindow.addEventListener('keyup', (e) => {\n  if (!token || dead) {\n    return\n  }\n\n  if (e.code == 'KeyW') {\n    accel = false\n    self.accel = null\n    send('accel_off')\n  } else if (e.code == 'KeyS') {\n    brake = false\n    send('brake_off')\n  } else if (e.code == 'KeyA') {\n    turn_left_ramp = 0\n    turn_left = false\n  } else if (e.code == 'KeyD') {\n    turn_right_ramp = 0\n    turn_right = false\n  } else if (e.code == 'Space') {\n    firing = false\n  }\n}, true)\n\nwindow.addEventListener('blur', (e) => {\n  if (!token || dead) {\n    return\n  }\n\n  send('accel_off')\n  send('brake_off')\n  accel = false\n  self.accel = null\n  brake = false\n  turn_left = false\n  turn_right = false\n  firing = false\n}, true)\n\nconst drawShip = (ship, scale) => {\n  const cx = ctx.canvas.width / 2\n  const cy = ctx.canvas.height / 2\n\n  const [p1, p2, p3, p4] = geom.getShipPoints(ship)\n  let [x1, y1] = p1\n  let [x2, y2] = p2\n  let [x3, y3] = p3\n  let [x4, y4] = p4\n\n  x1 = cx + ship.posX - self.posX + x1 * scale\n  x2 = cx + ship.posX - self.posX + x2 * scale\n  x3 = cx + ship.posX - self.posX + x3 * scale\n  x4 = cx + ship.posX - self.posX + x4 * scale\n\n  y1 = cy + ship.posY - self.posY + y1 * scale\n  y2 = cy + ship.posY - self.posY + y2 * scale\n  y3 = cy + ship.posY - self.posY + y3 * scale\n  y4 = cy + ship.posY - self.posY + y4 * scale\n\n  ctx.strokeStyle = '#fff'\n  ctx.beginPath()\n  ctx.moveTo(x1, y1)\n  ctx.lineTo(x2, y2)\n  ctx.lineTo(x3, y3)\n  ctx.lineTo(x4, y4)\n  ctx.lineTo(x1, y1)\n  ctx.stroke()\n\n  if (ship.accel) {\n    const [tp1, tp2, tp3, tp4, tp5] = geom.getThrusterPoints(ship);\n    let [x1, y1] = tp1\n    let [x2, y2] = tp2\n    let [x3, y3] = tp3\n    let [x4, y4] = tp4\n    let [x5, y5] = tp5\n\n    let xo = (Math.random() - 0.5) * scale / 4;\n    let yo = (Math.random() - 0.5) * scale / 4;\n\n    x1 = cx + ship.posX - self.posX + x1 * scale\n    x2 = cx + ship.posX - self.posX + x2 * scale\n    x3 = cx + ship.posX - self.posX + x3 * scale\n    x4 = cx + ship.posX - self.posX + x4 * scale\n    x5 = cx + ship.posX - self.posX + x5 * scale\n  \n    y1 = cy + ship.posY - self.posY + y1 * scale\n    y2 = cy + ship.posY - self.posY + y2 * scale\n    y3 = cy + ship.posY - self.posY + y3 * scale\n    y4 = cy + ship.posY - self.posY + y4 * scale\n    y5 = cy + ship.posY - self.posY + y5 * scale\n\n    x3 += xo\n    y3 += yo\n    x5 += xo / 2\n    y5 += yo / 2  \n\n    ctx.strokeStyle = '#888'\n    ctx.beginPath()\n    ctx.moveTo(x1, y1)\n    ctx.lineTo(x2, y2)\n    ctx.lineTo(x3, y3)\n    ctx.lineTo(x4, y4)\n    ctx.lineTo(x1, y1)\n    ctx.lineTo(x5, y5)\n    ctx.stroke()\n  }\n}\n\nconst drawBullet = (bullet, scale) => {\n  const cx = ctx.canvas.width / 2\n  const cy = ctx.canvas.height / 2\n\n  let x = bullet.posX\n  let y = bullet.posY\n\n  x = cx + bullet.posX - self.posX + x * scale\n  y = cy + bullet.posY - self.posY + y * scale\n\n  ctx.fillStyle = '#fff'\n  ctx.beginPath()\n  ctx.arc(x, y, 0.2 * scale, 0, 2 * Math.PI)\n  ctx.fill()\n}\n\nconst frame = () => {\n  ctx.canvas.width = window.innerWidth\n  ctx.canvas.height = window.innerHeight\n  const unitSize = Math.min(ctx.canvas.width, ctx.canvas.height) * (1 \n    / physics.MAX_BULLET_DISTANCE)\n  \n  if (firing) {\n    send('fire')\n  }\n\n  if (self == null) {\n    return\n  }\n\n  const xm = ((self.posX % GRID_SIZE) + GRID_SIZE) % GRID_SIZE\n  const ym = ((self.posY % GRID_SIZE) + GRID_SIZE) % GRID_SIZE\n\n  ctx.fillStyle = '#000'\n  ctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height)\n\n  // draw grid\n  ctx.lineWidth = 1\n  ctx.strokeStyle = '#333'\n  for (let x = xm * unitSize; \n    x < ctx.canvas.width; \n    x += GRID_SIZE * unitSize) {\n      ctx.beginPath()\n    const dx = x | 0 + 0.5;\n    ctx.moveTo(dx, 0)\n    ctx.lineTo(dx, ctx.canvas.height)\n    ctx.stroke()\n  }\n  for (let y = ym * unitSize; \n    y < ctx.canvas.height;\n    y += GRID_SIZE * unitSize) {\n    ctx.beginPath()\n    const dy = y | 0 + 0.5;\n    ctx.moveTo(0, dy)\n    ctx.lineTo(ctx.canvas.width, dy)\n    ctx.stroke()\n  }\n\n  // draw player ship\n  ctx.lineWidth = 1.5\n  drawShip(self, unitSize)\n\n  // draw ships\n  ctx.lineWidth = 1\n  for (const ship of ships) {\n    drawShip(ship, unitSize)\n  }\n\n  // draw bullets\n  for (const bullet of bullets) {\n    drawBullet(bullet, unitSize)\n  }\n\n  window.requestAnimationFrame(frame)\n}\n\nws.addEventListener('open', () => {\n  console.log(`  O wonder!\n  How many goodly creatures are there here!\n  How beauteous mankind is! O brave new world,\n  That has such people in't.`)\n  dead = false\n})\n\nws.addEventListener('message', (e) => {\n  const msg = e.data\n\n  let [cmd, ...args] = msg.split(' ')\n  args = args.join(' ')\n\n  if (cmd === 'your_token') {\n    if (token === null) {\n      window.requestAnimationFrame(frame)\n    }\n    token = args\n  } else if (cmd === 'you') {\n    const obj = JSON.parse(args)\n    if (self === null) {\n      self = obj\n    } else {\n      if (Math.abs(obj.posX - self.posX) > 0.3) {\n        self.posX = (self.posX + obj.posX) / 2;\n        self.velX = (self.velX + obj.velX) / 2;\n      }\n      if (Math.abs(obj.posY - self.posY) > 0.3) {\n        self.posY = (self.posY + obj.posY) / 2;\n        self.velY = (self.velY + obj.velY) / 2;\n      }\n      if (Math.abs(obj.velX - self.velX) > 0.2) {\n        self.velX = obj.velX;\n      }\n      if (Math.abs(obj.velY - self.velY) > 0.2) {\n        self.posY = obj.posY;\n      }\n      if (self.accel === null && obj.accel !== null) {\n        ws.send('accel_off');\n      } else if (self.accel !== null && obj.accel === null) {\n        ws.send('accel_on');\n      } else if (!brake && obj.brake !== null) {\n        ws.send('brake_off');\n      } else if (brake && obj.brake === null) {\n        ws.send('brake_on');\n      }\n    }\n  } else if (cmd === 'unrecognized') {\n    token = ''\n    self = {}\n  } else if (cmd === 'nearby') {\n    [ships, bullets] = JSON.parse(args)\n  } else if (cmd === 'kill_ship') {\n    // display explosion animation????\n    if (args == self._id) {\n      token = ''\n      self = {}\n    } else {\n      ships = ships.filter(ship => ship._id !== args)\n    }\n  } else if (cmd === 'remove_ship') {\n    if (args == self._id) {\n      token = ''\n      self = {}\n    } else {\n      ships = ships.filter(ship => ship._id !== args)\n    }\n  } else if (cmd === 'remove_bullet') {\n    bullets = bullets.filter(bullet => bullet._id !== args)\n  }\n})\n\n// message types (server -> client):\n//      your_token TOKEN\n//      you SHIP\n//      unrecognized\n//      collision_sound\n//      kill_ship SHIP_ID\n//      remove_ship SHIP_ID\n//      remove_bullet BULLET_ID\n//      nearby [LIST_OF_SHIPS, LIST_OF_BULLETS]\n// message types (client -> server), must be preceded with token:\n//      accel_on\n//      accel_off\n//      brake_on\n//      brake_off\n//      turn NEW_ORIENTATION\n//      fire\n//      special_weapon\n","const TICKS_PER_SECOND = 30\nconst MAX_SHIP_VELOCITY = 32 / TICKS_PER_SECOND\nconst MIN_SHIP_VELOCITY = 0.01\nconst BULLET_VELOCITY = MAX_SHIP_VELOCITY * 2\nconst BRAKE_MUL = (MIN_SHIP_VELOCITY / MAX_SHIP_VELOCITY) ** (1 / (TICKS_PER_SECOND * 2.5))\nconst INERTIA_MUL = (MIN_SHIP_VELOCITY / MAX_SHIP_VELOCITY) ** (1 / (TICKS_PER_SECOND * 120))\nconst MAX_BULLET_DISTANCE = 56\nconst DELAY_BETWEEN_BULLETS_MS = 250\n\nconst getAccelMul = (accelTimeMs) => { // time in milliseconds\n  return 0.0125 + 0.0000125 * accelTimeMs\n}\n\nconst checkMinVelocity = (ship) => {\n  const v = Math.hypot(ship.velX, ship.velY)\n  if (v <= MIN_SHIP_VELOCITY) {\n    ship.velX = 0\n    ship.velY = 0\n  }\n}\n\nconst checkMaxVelocity = (ship) => {\n  const v = Math.hypot(ship.velX, ship.velY)\n  if (v > MAX_SHIP_VELOCITY) {\n    ship.velX *= MAX_SHIP_VELOCITY / v\n    ship.velY *= MAX_SHIP_VELOCITY / v\n  }\n}\n\nconst accel = (ship, accelTimeMs) => {\n  const accelMul = getAccelMul(accelTimeMs)\n  ship.velX += accelMul * Math.sin(-ship.orient)\n  ship.velY += accelMul * Math.cos(-ship.orient)\n  checkMaxVelocity(ship)\n}\n\nconst inertia = (ship) => {\n  ship.velX *= INERTIA_MUL\n  ship.velY *= INERTIA_MUL\n  checkMinVelocity(ship)\n}\n\nconst brake = (ship) => {\n  ship.velX *= BRAKE_MUL\n  ship.velY *= BRAKE_MUL\n  checkMinVelocity(ship)\n}\n\nmodule.exports = {\n  TICKS_PER_SECOND, \n  MAX_SHIP_VELOCITY,\n  BULLET_VELOCITY,\n  MAX_BULLET_DISTANCE,\n  DELAY_BETWEEN_BULLETS_MS,\n  accel,\n  inertia,\n  brake }\n","const timeMs = () => new Date().getTime()\n\nmodule.exports = { timeMs }\n","const pointInTriangle = (p1, p2, p3, p) => {\n  const [x1, y1] = p1\n  const [x2, y2] = p2\n  const [x3, y3] = p3\n  const [xp, yp] = p\n\n  const c1 = ((y2 - y3) * (xp - x3) + (x3 - x2) * (yp - y3)) \n           / ((y2 - y3) * (x1 - x3) + (x3 - x2) * (y1 - y3))\n  const c2 = ((y3 - y1) * (xp - x3) + (x1 - x3) * (yp - y3)) \n           / ((y2 - y3) * (x1 - x3) + (x3 - x2) * (y1 - y3))\n  const c3 = 1 - c1 - c2\n  return c1 > 0 && c2 > 0 && c3 > 0\n}\n\nconst wrapRadianAngle = (angle) => {\n  return (angle + Math.PI) % (2 * Math.PI) - Math.PI\n}\n\nconst rotatePoint = (s, c, x, y) => [x * c - y * s, x * s + y * c]\n\nconst getShipPoints = (ship) => {\n  const s = Math.sin(ship.orient)\n  const c = Math.cos(ship.orient)\n\n  return [\n    rotatePoint(s, c,  0   , +1   ),\n    rotatePoint(s, c, +1   , +1.5 ),\n    rotatePoint(s, c,  0   , -1   ),\n    rotatePoint(s, c, -1   , +1.5 )\n  ]\n  /*\n  return [\n    [      s,           c    ], // (0, 1)\n    [1.5 * s + c, 1.5 * c - s], // (1, -1.5)\n    [     -s,          -c    ], // (0, -1)\n    [1.5 * s - c, 1.5 * c + s]] // (-1, 1.5)\n    */\n}\n\nconst getThrusterPoints = (ship) => {\n  const s = Math.sin(ship.orient)\n  const c = Math.cos(ship.orient)\n\n  return [\n    rotatePoint(s, c,  0   , +1   ),\n    rotatePoint(s, c, +0.5 , +1.25),\n    rotatePoint(s, c,  0   , +2.5 ),\n    rotatePoint(s, c, -0.5 , +1.25),\n    rotatePoint(s, c,  0   , +1.75),\n  ]\n  /*\n  return [\n    [       -s          ,        -c          ], // (0, -1)\n    [-1.25 * s + 0.5 * c, -1.25 * c - 0.5 * s], // (0.5, -1.25)\n    [   -2 * s          ,    -2 * c          ], // (0, -2)\n    [-1.25 * s - 0.5 * c, -1.25 * c + 0.5 * s], // (0.5, -1.25)\n    [-1.75 * s          , -1.75 * c          ]] // (0, -1.75)\n    */\n}\n\nmodule.exports = { \n  pointInTriangle, \n  wrapRadianAngle, \n  getShipPoints, \n  getThrusterPoints }\n"],"sourceRoot":""}