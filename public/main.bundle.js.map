{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./js/main.js","webpack:///./src/physics.js","webpack:///./src/utils/chron.js","webpack:///./src/utils/geom.js"],"names":["physics","require","geom","chron","canvas","document","getElementById","ctx","getContext","here","location","tps","TICKS_PER_SECOND","GRID_SIZE","TURN_UNIT","Math","PI","TICK_MS","inGame","ws","token","self","firing","accel","accelStart","brake","turn_left","turn_right","dead","ships","bullets","turn_left_ramp","turn_right_ramp","lines","tpf","last_partial","send_turn","showDialog","style","display","hideDialog","hideLose","joinGame","WebSocket","hostname","port","pathname","addEventListener","e","msg","data","cmd","args","split","join","window","requestAnimationFrame","frame","obj","JSON","parse","abs","posX","velX","posY","velY","leaveGame","innerHTML","matching","find","ship","_id","explosion","filter","bullet","close","send","serverTick","stringify","orient","timeMs","inertia","setInterval","partialTick","delta","min","code","drawShip","scale","cx","width","cy","height","p1","p2","p3","p4","getShipPoints","x1","y1","x2","y2","x3","y3","x4","y4","strokeStyle","beginPath","moveTo","lineTo","stroke","tp1","tp2","tp3","tp4","tp5","getThrusterPoints","x5","y5","xo","random","yo","drawBullet","x","y","fillStyle","arc","fill","drawLine","line","angle","r","alpha","xr","cos","yr","sin","createLine","xv","yv","atan2","hypot","vx","vy","vangle","x6","y6","push","console","log","time","innerWidth","innerHeight","unitSize","MAX_BULLET_DISTANCE","xm","ym","fillRect","lineWidth","dx","dy","MAX_SHIP_VELOCITY","MIN_SHIP_VELOCITY","BULLET_VELOCITY","BRAKE_MUL","INERTIA_MUL","DELAY_BETWEEN_BULLETS_MS","getAccelMul","accelTimeMs","checkMinVelocity","v","checkMaxVelocity","getPlanets","accelMul","module","exports","Date","getTime","pointInTriangle","p","xp","yp","c1","c2","c3","wrapRadianAngle","rotatePoint","s","c","rotatePointOffset","getRealShipPoints","points","getCollisionPoints"],"mappings":"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","file":"main.bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./js/main.js\");\n","const physics = require('../src/physics')\nconst geom = require('../src/utils/geom')\nconst chron = require('../src/utils/chron')\nconst canvas = document.getElementById('screen')\nconst ctx = canvas.getContext('2d')\nconst here = document.location\nconst tps = physics.TICKS_PER_SECOND\nconst GRID_SIZE = 10\nconst TURN_UNIT = 2 * Math.PI / tps\nconst TICK_MS = 1000 / tps\n\nlet inGame = false\nlet ws = null\nlet token = null\nlet self = null\nlet firing = false\nlet accel = false\nlet accelStart = 0\nlet brake = false\nlet turn_left = false\nlet turn_right = false\nlet dead = false\nlet ships = []\nlet bullets = []\nlet turn_left_ramp = 0\nlet turn_right_ramp = 0\nlet lines = []\nlet tpf = 1\n\nlet last_partial = null\nlet send_turn = false\n\nconst showDialog = () => {\n  document.getElementById('dialog').style.display = 'block'\n}\n\nconst hideDialog = () => {\n  document.getElementById('dialog').style.display = 'none'\n}\n\nconst hideLose = () => {\n  document.getElementById('defeat').style.display = 'none'\n  document.getElementById('defeatcrash').style.display = 'none'\n  document.getElementById('defeatplanet').style.display = 'none'\n  document.getElementById('defeatname').style.display = 'none'\n}\nhideLose()\n\nconst joinGame = () => {\n  if (!inGame) {\n    hideDialog()\n    ws = new WebSocket(`ws://${here.hostname}:${here.port}${here.pathname}`)\n    inGame = true\n    \n    ws.addEventListener('open', () => {\n      dead = false\n    })\n\n    ws.addEventListener('message', (e) => {\n      const msg = e.data\n\n      let [cmd, ...args] = msg.split(' ')\n      args = args.join(' ')\n\n      if (cmd === 'your_token') {\n        if (token == null) {\n          window.requestAnimationFrame(frame)\n        }\n        token = args\n      } else if (cmd === 'you') {\n        const obj = JSON.parse(args)\n        if (self === null) {\n          self = obj\n        } else {\n          if (Math.abs(obj.posX - self.posX) > 0.3) {\n            self.posX = (self.posX + obj.posX) / 2\n            self.velX = (self.velX + obj.velX) / 2\n          }\n          if (Math.abs(obj.posY - self.posY) > 0.3) {\n            self.posY = (self.posY + obj.posY) / 2\n            self.velY = (self.velY + obj.velY) / 2\n          }\n          if (Math.abs(obj.velX - self.velX) > 0.2) {\n            self.velX = obj.velX\n          }\n          if (Math.abs(obj.velY - self.velY) > 0.2) {\n            self.posY = obj.posY\n          }\n          if (!accel && obj.accel !== null) {\n            send_turn = true\n          } else if (accel && obj.accel === null) {\n            send_turn = true\n          } else if (!brake && obj.brake !== null) {\n            send_turn = true\n          } else if (brake && obj.brake === null) {\n            send_turn = true\n          }\n        }\n      } else if (cmd === 'unrecognized') {\n        leaveGame()\n      } else if (cmd === 'nearby') {\n        [ships, bullets] = JSON.parse(args)\n      } else if (cmd === 'defeated') {\n        hideLose()\n        leaveGame()\n        document.getElementById('defeat').style.display = 'block'\n        document.getElementById('defeatname').style.display = 'inline'\n        document.getElementById('defeatname').innerHTML = args\n      } else if (cmd === 'defeated_collision') {\n        hideLose()\n        leaveGame()\n        document.getElementById('defeatcrash').style.display = 'block'\n        document.getElementById('defeatname').style.display = 'inline'\n        document.getElementById('defeatname').innerHTML = args\n      } else if (cmd === 'defeated_planet') {\n        hideLose()\n        leaveGame()\n        document.getElementById('defeatplanet').style.display = 'block'\n      } else if (cmd === 'kill_ship') {\n        const matching = ships.find(ship => ship._id === args)\n        if (matching !== null) {\n          explosion(matching)\n        }\n        ships = ships.filter(ship => ship._id !== args)\n      } else if (cmd === 'remove_ship') {\n        ships = ships.filter(ship => ship._id !== args)\n      } else if (cmd === 'remove_bullet') {\n        bullets = bullets.filter(bullet => bullet._id !== args)\n      }\n    })\n  }\n}\n\nconst leaveGame = () => {\n  if (ws !== null) {\n    ws.close()\n  }\n  dead = true\n  self = null\n  ws = null\n  token = null\n  inGame = false\n  showDialog()\n}\n\nconst send = (msg) => {\n  if (token) {\n    ws.send(`${token} ${msg}`)\n  }\n}\n\nconst serverTick = () => {\n  if (!ws || !self) {\n    return\n  }\n\n  if (send_turn) {\n    send(`control ${JSON.stringify([self.orient, accel, brake])}`)\n    send_turn = false\n  }\n  \n  if (firing) {\n    send('fire')\n  }\n  \n  if (accel) {\n    physics.accel(self, chron.timeMs() - accelStart)\n  }\n  if (brake) {\n    physics.brake(self)\n  }\n  physics.inertia(self)\n}\nsetInterval(serverTick, TICK_MS)\n\nconst partialTick = (delta) => {\n  tpf = 1.0 * delta / TICK_MS\n\n  // turning\n  if (turn_left && !turn_right) {\n    self.orient -= turn_left_ramp * TURN_UNIT * tpf\n    turn_left_ramp = Math.min(1, turn_left_ramp + tpf * 0.1)\n    accelStart = chron.timeMs()\n    send_turn = true\n  } else if (turn_right && !turn_left) {\n    self.orient += turn_right_ramp * TURN_UNIT * tpf\n    turn_right_ramp = Math.min(1, turn_right_ramp + tpf * 0.1)\n    accelStart = chron.timeMs()\n    send_turn = true\n  }\n  \n  // interpolate\n  self.posX += tpf * self.velX\n  self.posY += tpf * self.velY\n\n  for (const ship of ships) {\n    ship.posX += tpf * ship.velX\n    ship.posY += tpf * ship.velY\n  }\n  for (const bullet of bullets) {\n    bullet.posX += tpf * bullet.velX\n    bullet.posY += tpf * bullet.velY\n  }\n}\n\nwindow.addEventListener('keydown', (e) => {\n  if (!token || dead) {\n    return\n  }\n\n  if (e.code == 'KeyW') {\n    accel = true\n    self.accel = accelStart = chron.timeMs()\n    send_turn = true\n  } else if (e.code == 'KeyS') {\n    brake = true\n    send_turn = true\n  } else if (e.code == 'KeyA') {\n    turn_left = true\n  } else if (e.code == 'KeyD') {\n    turn_right = true\n  } else if (e.code == 'Space') {\n    firing = true\n  }\n}, true)\n\nwindow.addEventListener('keyup', (e) => {\n  if (!token || dead) {\n    return\n  }\n\n  if (e.code == 'KeyW') {\n    accel = false\n    self.accel = null\n    send_turn = true\n  } else if (e.code == 'KeyS') {\n    brake = false\n    send_turn = true\n  } else if (e.code == 'KeyA') {\n    turn_left_ramp = 0\n    turn_left = false\n  } else if (e.code == 'KeyD') {\n    turn_right_ramp = 0\n    turn_right = false\n  } else if (e.code == 'Space') {\n    firing = false\n  }\n}, true)\n\nwindow.addEventListener('blur', () => {\n  if (!token || dead) {\n    return\n  }\n\n  accel = false\n  self.accel = null\n  brake = false\n  turn_left = false\n  turn_right = false\n  firing = false\n  send_turn = true\n}, true)\n\nwindow.addEventListener('beforeupload', () => {\n  send('disconnect')\n}, true)\n\nconst drawShip = (ship, scale) => {\n  const cx = ctx.canvas.width / 2\n  const cy = ctx.canvas.height / 2\n\n  const [p1, p2, p3, p4] = geom.getShipPoints(ship)\n  let [x1, y1] = p1\n  let [x2, y2] = p2\n  let [x3, y3] = p3\n  let [x4, y4] = p4\n\n  x1 = cx + (self.posX - ship.posX + x1) * scale\n  x2 = cx + (self.posX - ship.posX + x2) * scale\n  x3 = cx + (self.posX - ship.posX + x3) * scale\n  x4 = cx + (self.posX - ship.posX + x4) * scale\n\n  y1 = cy + (self.posY - ship.posY + y1) * scale\n  y2 = cy + (self.posY - ship.posY + y2) * scale\n  y3 = cy + (self.posY - ship.posY + y3) * scale\n  y4 = cy + (self.posY - ship.posY + y4) * scale\n\n  ctx.strokeStyle = '#fff'\n  ctx.beginPath()\n  ctx.moveTo(x1, y1)\n  ctx.lineTo(x2, y2)\n  ctx.lineTo(x3, y3)\n  ctx.lineTo(x4, y4)\n  ctx.lineTo(x1, y1)\n  ctx.stroke()\n\n  if (ship.accel) {\n    const [tp1, tp2, tp3, tp4, tp5] = geom.getThrusterPoints(ship)\n    let [x1, y1] = tp1\n    let [x2, y2] = tp2\n    let [x3, y3] = tp3\n    let [x4, y4] = tp4\n    let [x5, y5] = tp5\n\n    let xo = (Math.random() - 0.5) * scale / 4\n    let yo = (Math.random() - 0.5) * scale / 4\n\n    x1 = cx + (self.posX - ship.posX + x1) * scale\n    x2 = cx + (self.posX - ship.posX + x2) * scale\n    x3 = cx + (self.posX - ship.posX + x3) * scale\n    x4 = cx + (self.posX - ship.posX + x4) * scale\n    x5 = cx + (self.posX - ship.posX + x5) * scale\n  \n    y1 = cy + (self.posY - ship.posY + y1) * scale\n    y2 = cy + (self.posY - ship.posY + y2) * scale\n    y3 = cy + (self.posY - ship.posY + y3) * scale\n    y4 = cy + (self.posY - ship.posY + y4) * scale\n    y5 = cy + (self.posY - ship.posY + y5) * scale\n\n    x3 += xo\n    y3 += yo\n    x5 += xo / 2\n    y5 += yo / 2  \n\n    ctx.strokeStyle = '#888'\n    ctx.beginPath()\n    ctx.moveTo(x1, y1)\n    ctx.lineTo(x2, y2)\n    ctx.lineTo(x3, y3)\n    ctx.lineTo(x4, y4)\n    ctx.lineTo(x1, y1)\n    ctx.lineTo(x5, y5)\n    ctx.stroke()\n  }\n}\n\nconst drawBullet = (bullet, scale) => {\n  const cx = ctx.canvas.width / 2\n  const cy = ctx.canvas.height / 2\n\n  const x = cx + (self.posX - bullet.posX) * scale\n  const y = cy + (self.posY - bullet.posY) * scale\n\n  ctx.fillStyle = '#fff'\n  ctx.beginPath()\n  ctx.arc(x, y, 0.2 * scale, 0, 2 * Math.PI)\n  ctx.fill()\n}\n\nconst drawLine = (line, scale) => {\n  const { x, y, angle, r, alpha } = line\n  const cx = ctx.canvas.width / 2\n  const cy = ctx.canvas.height / 2\n\n  const x1 = cx + scale * (x + self.posX - line.xr - r * Math.cos(angle))\n  const y1 = cy + scale * (y + self.posY - line.yr - r * Math.sin(angle))\n  const x2 = cx + scale * (x + self.posX - line.xr + r * Math.cos(angle))\n  const y2 = cy + scale * (y + self.posY - line.yr + r * Math.sin(angle))\n\n  ctx.strokeStyle = `rgba(192,192,192,${alpha * 0.01})` \n  ctx.beginPath()\n  ctx.moveTo(x1, y1)\n  ctx.lineTo(x2, y2)\n  ctx.stroke()\n}\n\nconst createLine = (x1, y1, x2, y2, xr, yr, xv, yv) => {\n  const [x, y] = [(x1 + x2) / 2, (y1 + y2) / 2]\n  const angle = Math.atan2(x2 - x1, y2 - y1)\n  const r = Math.hypot(x2 - x1, y2 - y1) / 2\n  const vx = -0.05 + 0.1 * Math.random() - xv * tpf\n  const vy = -0.05 + 0.1 * Math.random() - yv * tpf\n  const vangle = -0.1 + 0.2 * Math.random()\n\n  // x, y, xr, yr, angle, r, alpha, vx, vy, vangle\n  return { x, y, xr, yr, angle, alpha: 100, r, vx, vy, vangle }\n}\n\nconst explosion = (ship) => {\n  const [p1, p2, p3, p4] = geom.getShipPoints(ship)\n  let [x1, y1] = p1\n  let [x2, y2] = p2\n  let [x3, y3] = p3\n  let [x4, y4] = p4\n\n  let [x5, y5] = [(x1 + x2) / 2, (y1 + y2) / 2]\n  let [x6, y6] = [(x1 + x4) / 2, (y1 + y4) / 2]\n\n  lines.push(createLine(x1, y1, x5, y5, \n    ship.posX, ship.posY, ship.velX, ship.velY))\n  lines.push(createLine(x5, y5, x2, y2, \n    ship.posX, ship.posY, ship.velX, ship.velY))\n  lines.push(createLine(x2, y2, x3, y3, \n    ship.posX, ship.posY, ship.velX, ship.velY))\n  lines.push(createLine(x3, y3, x4, y4, \n    ship.posX, ship.posY, ship.velX, ship.velY))\n  lines.push(createLine(x4, y4, x6, y6, \n    ship.posX, ship.posY, ship.velX, ship.velY))\n  lines.push(createLine(x6, y6, x1, y1, \n    ship.posX, ship.posY, ship.velX, ship.velY))\n  console.log(lines)\n}\n\nconst frame = (time) => {\n  ctx.canvas.width = window.innerWidth\n  ctx.canvas.height = window.innerHeight\n  const unitSize = Math.min(ctx.canvas.width, ctx.canvas.height) * (1 \n    / physics.MAX_BULLET_DISTANCE)\n\n  if (!token || !self) {\n    return\n  }\n\n  if (last_partial != null) {\n    const delta = time - last_partial\n    partialTick(delta)\n  }\n  last_partial = time\n\n  const xm = ((self.posX % GRID_SIZE) + GRID_SIZE) % GRID_SIZE\n  const ym = ((self.posY % GRID_SIZE) + GRID_SIZE) % GRID_SIZE\n\n  ctx.fillStyle = '#000'\n  ctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height)\n\n  // draw grid\n  ctx.lineWidth = 1\n  ctx.strokeStyle = '#333'\n  for (let x = xm * unitSize; \n    x < ctx.canvas.width; \n    x += GRID_SIZE * unitSize) {\n    ctx.beginPath()\n    const dx = x | 0 + 0.5\n    ctx.moveTo(dx, 0)\n    ctx.lineTo(dx, ctx.canvas.height)\n    ctx.stroke()\n  }\n  for (let y = ym * unitSize; \n    y < ctx.canvas.height;\n    y += GRID_SIZE * unitSize) {\n    ctx.beginPath()\n    const dy = y | 0 + 0.5\n    ctx.moveTo(0, dy)\n    ctx.lineTo(ctx.canvas.width, dy)\n    ctx.stroke()\n  }\n\n  // draw player ship\n  ctx.lineWidth = 1.5\n  drawShip(self, unitSize)\n\n  // draw ships\n  ctx.lineWidth = 1\n  for (const ship of ships) {\n    drawShip(ship, unitSize)\n  }\n\n  // draw bullets\n  for (const bullet of bullets) {\n    drawBullet(bullet, unitSize)\n  }\n\n  // draw lines\n  for (const line of lines) {\n    drawLine(line, unitSize)\n\n    line.x += line.vx\n    line.y += line.vy\n    line.angle += line.vangle\n    line.vx *= 0.99\n    line.vy *= 0.99\n    line.vangle *= 0.99\n    line.alpha -= 1\n  }\n\n  lines = lines.filter(line => line.alpha > 0)\n\n  window.requestAnimationFrame(frame)\n}\n\ndocument.getElementById('btnplay').addEventListener('click', () => joinGame())\n\nshowDialog()\n\n// message types (server -> client):\n//      your_token TOKEN\n//      you SHIP\n//      unrecognized\n//      collision_sound\n//      defeated WINNER_NAME\n//      defeated_collision WINNER_NAME\n//      defeated_planet\n//      kill_ship SHIP_ID\n//      remove_ship SHIP_ID\n//      remove_bullet BULLET_ID\n//      nearby [LIST_OF_SHIPS, LIST_OF_BULLETS]\n// message types (client -> server), must be preceded with token:\n//      disconnect\n//      control [DIRECTION, ACCEL, BRAKE]\n//      fire\n//      special_weapon\n","const TICKS_PER_SECOND = 24\nconst MAX_SHIP_VELOCITY = 32 / TICKS_PER_SECOND\nconst MIN_SHIP_VELOCITY = 0.01\nconst BULLET_VELOCITY = MAX_SHIP_VELOCITY * 2\nconst BRAKE_MUL = (MIN_SHIP_VELOCITY / MAX_SHIP_VELOCITY) ** (1 / (TICKS_PER_SECOND * 2.5))\nconst INERTIA_MUL = (MIN_SHIP_VELOCITY / MAX_SHIP_VELOCITY) ** (1 / (TICKS_PER_SECOND * 90))\nconst MAX_BULLET_DISTANCE = 56\nconst DELAY_BETWEEN_BULLETS_MS = 250\n\nconst getAccelMul = (accelTimeMs) => { // time in milliseconds\n  return 0.05 + 0.000025 * accelTimeMs\n}\n\nconst checkMinVelocity = (ship) => {\n  const v = Math.hypot(ship.velX, ship.velY)\n  if (v <= MIN_SHIP_VELOCITY) {\n    ship.velX = 0\n    ship.velY = 0\n  }\n}\n\nconst checkMaxVelocity = (ship) => {\n  const v = Math.hypot(ship.velX, ship.velY)\n  if (v > MAX_SHIP_VELOCITY) {\n    ship.velX *= MAX_SHIP_VELOCITY / v\n    ship.velY *= MAX_SHIP_VELOCITY / v\n  }\n}\n\nconst getPlanets = () => {\n  return [] /// TODO\n}\n\nconst accel = (ship, accelTimeMs) => {\n  const accelMul = getAccelMul(accelTimeMs)\n  ship.velX += accelMul * Math.sin(-ship.orient)\n  ship.velY += accelMul * Math.cos(-ship.orient)\n  checkMaxVelocity(ship)\n}\n\nconst inertia = (ship) => {\n  ship.velX *= INERTIA_MUL\n  ship.velY *= INERTIA_MUL\n  checkMinVelocity(ship)\n}\n\nconst brake = (ship) => {\n  ship.velX *= BRAKE_MUL\n  ship.velY *= BRAKE_MUL\n  checkMinVelocity(ship)\n}\n\nmodule.exports = {\n  TICKS_PER_SECOND, \n  MAX_SHIP_VELOCITY,\n  BULLET_VELOCITY,\n  MAX_BULLET_DISTANCE,\n  DELAY_BETWEEN_BULLETS_MS,\n  accel,\n  inertia,\n  brake,\n  getPlanets }\n","const timeMs = () => new Date().getTime()\n\nmodule.exports = { timeMs }\n","const pointInTriangle = (p1, p2, p3, p) => {\n  const [x1, y1] = p1\n  const [x2, y2] = p2\n  const [x3, y3] = p3\n  const [xp, yp] = p\n\n  const c1 = ((y2 - y3) * (xp - x3) + (x3 - x2) * (yp - y3)) \n           / ((y2 - y3) * (x1 - x3) + (x3 - x2) * (y1 - y3))\n  const c2 = ((y3 - y1) * (xp - x3) + (x1 - x3) * (yp - y3)) \n           / ((y2 - y3) * (x1 - x3) + (x3 - x2) * (y1 - y3))\n  const c3 = 1 - c1 - c2\n  return c1 > 0 && c2 > 0 && c3 > 0\n}\n\nconst wrapRadianAngle = (angle) => {\n  return (angle + Math.PI) % (2 * Math.PI) - Math.PI\n}\n\nconst rotatePoint = (s, c, x, y) => [x * c - y * s, x * s + y * c]\n\nconst rotatePointOffset = (s, c, x, y, xo, yo) => \n  [xo + x * c - y * s, yo + x * s + y * c]\n\nconst getShipPoints = (ship) => {\n  const s = Math.sin(ship.orient)\n  const c = Math.cos(ship.orient)\n\n  return [\n    rotatePoint(s, c,  0   , +1   ),\n    rotatePoint(s, c, +1   , +1.5 ),\n    rotatePoint(s, c,  0   , -1   ),\n    rotatePoint(s, c, -1   , +1.5 )\n  ]\n}\n\nconst getRealShipPoints = (ship) => {\n  const points = getShipPoints(ship)\n  return [\n    [points[0][0] + ship.posX, points[0][1] + ship.posY],\n    [points[1][0] + ship.posX, points[1][1] + ship.posY],\n    [points[2][0] + ship.posX, points[2][1] + ship.posY],\n    [points[3][0] + ship.posX, points[3][1] + ship.posY]\n  ]\n}\n\nconst getCollisionPoints = (ship) => {\n  const s = Math.sin(ship.orient)\n  const c = Math.cos(ship.orient)\n  \n  return [\n    rotatePointOffset(s, c,  0   , 0    , ship.posX, ship.posY),\n    rotatePointOffset(s, c, +0.5 , +0.75, ship.posX, ship.posY),\n    rotatePointOffset(s, c, -0.5 , +0.75, ship.posX, ship.posY)\n  ]\n}\n\nconst getThrusterPoints = (ship) => {\n  const s = Math.sin(ship.orient)\n  const c = Math.cos(ship.orient)\n\n  return [\n    rotatePoint(s, c,  0   , +1   ),\n    rotatePoint(s, c, +0.5 , +1.25),\n    rotatePoint(s, c,  0   , +2.5 ),\n    rotatePoint(s, c, -0.5 , +1.25),\n    rotatePoint(s, c,  0   , +1.75),\n  ]\n}\n\nmodule.exports = { \n  pointInTriangle, \n  wrapRadianAngle, \n  getShipPoints, \n  getRealShipPoints, \n  getCollisionPoints,\n  getThrusterPoints }\n"],"sourceRoot":""}