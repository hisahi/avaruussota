{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./js/main.js","webpack:///./node_modules/js-cookie/src/js.cookie.js","webpack:///./src/physics.js","webpack:///./src/utils/chron.js","webpack:///./src/utils/geom.js","webpack:///./src/utils/lcg.js"],"names":["Cookies","require","physics","geom","chron","LCG","canvas","document","getElementById","ctx","getContext","here","location","tps","TICKS_PER_SECOND","GRID_SIZE","TURN_UNIT","Math","PI","TICK_MS","PLANET_SPIN_SPEED","BASE_SELF","dead","posX","posY","velX","velY","orient","speedMul","ZOOM_LEVELS","lcg","inGame","ws","token","self","connectTimer","firing","accel","accelStart","brake","turn_left","turn_right","turn_left_ramp","turn_right_ramp","ships","bullets","lines","planets","smokes","bubbles","tpf","planetAngle","playerCount","leaderboard","rubber","no_data","pinger","planetSeed","dialogOpacity","damageAlpha","damageGot","zoom","lastSmoke","last_partial","send_turn","firingInterval","style","animation","opacity","isMobile","test","navigator","userAgent","updateZoomText","textContent","nextZoom","f","indx","indexOf","length","set","checkSize","display","addEventListener","showDialog","body","position","overflow","hideDialog","hideLose","disconnect","leaveGame","joinGame","setTimeout","value","trim","blur","wsproto","protocol","replace","port","WebSocket","hostname","pathname","e","msg","data","cmd","args","split","join","nick","perk","random","toString","send","JSON","stringify","now","performance","max","parse","toFixed","obj","addBullets","oldHealth","ship","_id","health","hasOwnProperty","push","x","y","alpha","radius","highAgility","abs","score","name","latched","overdrive","getPlanetSeed","setPlanetSeed","getPlanets","filter","width","ceil","drawLeaderboard","parseFloat","explosion","innerHTML","matching","find","bullet","console","log","clearTimeout","setInterval","clearInterval","close","makeTd","text","td","createElement","makeTableRow","lb","tr","appendChild","leaderBoardTable","newBody","i","min","replaceChild","childNodes","serverTick","timeMs","lastFired","recoil","inertia","rubberband","gravityShip","gravityBullet","partialTick","delta","dist","velocity","b","MAX_BULLET_DISTANCE","jouter","jbase","jstick","applyPosition","hjbw","offsetWidth","hjbh","offsetHeight","offsetLeft","sqrt","offsetTop","h","hypot","willAccel","shouldUpdateAccelStart","angle","atan2","resetJoystickCenter","top","left","pageX","pageY","pressure","stopPropagation","stopImmediatePropagation","window","code","shiftKey","drawShip","scale","cx","cy","height","p1","p2","p3","p4","getShipPoints","x1","y1","x2","y2","x3","y3","x4","y4","x0","y0","strokeStyle","beginPath","moveTo","lineTo","stroke","tp1","tp2","tp3","tp4","tp5","getThrusterPoints","x5","y5","xo","yo","font","fillStyle","textAlign","fillText","drawBullet","arc","fill","drawLine","line","r","xr","cos","yr","sin","drawSmoke","smoke","sx","sy","drawBubble","bubble","createLine","xv","yv","vx","vy","vangle","computePlanetAngle","planet","drawPlanet","lineWidth","reseed","seed","gon","randomInt","randomOffset","x6","y6","frame","time","innerWidth","innerHeight","unitSize","VIEW_DISTANCE","xm","ym","fillRect","dx","dy","gradient","createRadialGradient","RUBBERBAND_BUFFER","addColorStop","rect","interval","shipid","Object","keys","bgradient","color","background","t","requestAnimationFrame","tryReadCookies","get","substring","options","option","selected","cookieZoom","isFinite","fullscreenElement","exitFullscreen","documentElement","requestFullscreen","factory","registeredInModuleLoader","define","module","exports","OldCookies","api","noConflict","extend","result","arguments","attributes","key","init","converter","path","defaults","expires","Date","setMilliseconds","getMilliseconds","toUTCString","write","encodeURIComponent","String","decodeURIComponent","escape","stringifiedAttributes","attributeName","cookie","cookies","rdecode","parts","slice","json","charAt","read","call","getJSON","apply","remove","withConverter","GRAV","MAX_SHIP_VELOCITY","MIN_SHIP_VELOCITY","LATCH_VELOCITY","BULLET_VELOCITY","BRAKE_MUL","INERTIA_MUL","DELAY_BETWEEN_BULLETS_MS","PLANET_CHUNK_SIZE","PLANET_SEED","getAccelMul","accelTimeMs","checkMinVelocity","v","checkMaxVelocity","maxvel","healthToVelocity","newPlanetSeed","floor","getPlanetsForChunk","xb","yb","xu","yu","accelMul","d","r2","getRubberbandRadius","pow","distCenter","maxRadius","baseX","baseY","getTime","EPSILON","pointInTriangle","p","xp","yp","c1","c2","c3","handleZeroEpsilon","pointOrientation","q","sign","onCollinearSegment","lineIntersectsLine","a1","a2","b1","b2","o1","o2","o3","o4","lineIntersectsTriangle","l1","l2","t1","t2","t3","closestSynchroDistance","A","B","C","D","wrapRadianAngle","getPlanetAngleMultiplier","vel","diff","sc","rotatePoint","s","c","rotatePointOffset","getOffsetShipPoints","points","getRealShipPoints","getCollisionPoints","LCG_A","LCG_C","Generator","constructor","val"],"mappings":"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","file":"main.bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./js/main.js\");\n","const Cookies = require('js-cookie')\nconst physics = require('../src/physics')\nconst geom = require('../src/utils/geom')\nconst chron = require('../src/utils/chron')\nconst LCG = require('../src/utils/lcg')\nconst canvas = document.getElementById('screen')\nconst ctx = canvas.getContext('2d')\nconst here = document.location\nconst tps = physics.TICKS_PER_SECOND\nconst GRID_SIZE = 10\nconst TURN_UNIT = 2 * Math.PI / tps\nconst TICK_MS = 1000 / tps\nconst PLANET_SPIN_SPEED = 0.02\nconst BASE_SELF = { dead: true, posX: 0, posY: 0, velX: 0, velY: 0, orient: 0, speedMul: 1 }\nconst ZOOM_LEVELS = [1.0, 1.5, 2.0, 2.5]\n\nlet lcg = new LCG(0)\nlet inGame = false\nlet ws = null\nlet token = null\nlet self = BASE_SELF\nlet connectTimer = null\n\nlet dead = false\nlet firing = false\nlet accel = false\nlet accelStart = 0\nlet brake = false\nlet turn_left = false\nlet turn_right = false\nlet turn_left_ramp = 0\nlet turn_right_ramp = 0\n\nlet ships = []\nlet bullets = []\nlet lines = []\nlet planets = []\nlet smokes = []\nlet bubbles = []\nlet tpf = 1\nlet planetAngle = 0\nlet playerCount = 1\nlet leaderboard = []\nlet rubber = 150\nlet no_data = 0\nlet pinger = null\nlet planetSeed = 0\nlet dialogOpacity = 0\nlet damageAlpha = 0\nlet damageGot = 0\nlet zoom = 1\n\nlet lastSmoke = {}\n\nlet last_partial = null\nlet send_turn = false\n\nlet firingInterval = 200\n\ndocument.getElementById('scoreanimation').style.animation = 'none'\ndocument.getElementById('scoreanimation').style.opacity = '0'\n\nconst isMobile = () => {\n  return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)\n}\n\nif (isMobile()) {\n  zoom = 1.5\n}\n\nconst updateZoomText = () => {\n  document.getElementById('btnzoom').textContent = `zoom: ${(zoom * 100) | 0}%`\n}\n\nconst nextZoom = (f) => {\n  let indx = (ZOOM_LEVELS.indexOf(zoom) + f) % ZOOM_LEVELS.length\n  if (indx < 0) {\n    indx += ZOOM_LEVELS.length\n  }\n  zoom = ZOOM_LEVELS[indx]\n  Cookies.set('avaruuspeli-zoom', indx)\n  updateZoomText()\n}\n\nconst checkSize = () => {\n  if (dead) {\n    document.getElementById('mobilecontrols').style.display = 'none'\n  } else {\n    document.getElementById('mobilecontrols').style.display = isMobile() ? 'block' : 'none'\n  }\n}\n\ndocument.addEventListener('resize', () => checkSize())\ncheckSize()\nupdateZoomText()\n\nconst showDialog = () => {\n  dialogOpacity = 0\n  document.getElementById('dialogbox').style.opacity = '0'\n  document.getElementById('dialog').style.display = 'block'\n  document.getElementById('stats').style.display = 'none'\n  document.getElementById('finalscore').style.display = 'block'\n  document.body.style.position = 'absolute'\n  document.body.style.overflow = ''\n}\n\nconst hideDialog = () => {\n  document.getElementById('dialog').style.display = 'none'\n  document.getElementById('stats').style.display = 'block'\n  document.body.style.position = 'relative'\n  document.body.style.overflow = 'hidden'\n}\n\nconst hideLose = () => {\n  document.getElementById('defeat').style.display = 'none'\n  document.getElementById('defeatcrash').style.display = 'none'\n  document.getElementById('defeatplanet').style.display = 'none'\n  document.getElementById('defeatname').style.display = 'none'\n  document.getElementById('disconnected').style.display = 'none'\n  document.getElementById('finalscore').style.display = 'none'\n}\n\nconst disconnect = () => {\n  hideLose()\n  document.getElementById('disconnected').style.display = 'inline'\n  leaveGame()\n}\n\nconst joinGame = () => {\n  if (!inGame) {\n    document.getElementById('scoreanimation').style.animation = 'none'\n    document.getElementById('scoreanimation').style.opacity = '0'\n    document.getElementById('onlinestatus').textContent = 'connecting'\n\n    connectTimer = setTimeout(() => disconnect(), 5000)\n    firingInterval = document.getElementById('perkselect').value.trim() == 'fasterrate' ? 150 : 200\n\n    document.getElementById('btnplay').blur()\n    hideDialog()\n\n    lines = []\n\n    let wsproto = here.protocol.replace('http', 'ws')\n    let port = here.port\n    if (port) {\n      port = `:${port}`\n    }\n    ws = new WebSocket(`${wsproto}//${here.hostname}${port}${here.pathname}`)\n    inGame = true\n\n    ws.addEventListener('message', (e) => {\n      const msg = e.data\n\n      let [cmd, ...args] = msg.split(' ')\n      args = args.join(' ')\n\n      if (cmd === 'your_token') {\n        document.getElementById('onlinestatus').textContent = 'in game'\n        token = args\n        let nick = document.getElementById('nick').value.trim()\n        const perk = document.getElementById('perkselect').value.trim()\n        if (nick.length < 1) {\n          nick = ((100000000 * Math.random()) | 0).toString()\n        } else {\n          Cookies.set('avaruuspeli-name', nick)\n        }\n        Cookies.set('avaruuspeli-perk', perk)\n        send(`nick ${JSON.stringify([nick, perk])}`)\n      } else if (cmd === 'pong') {\n        const now = performance.now()\n        document.getElementById('onlinestatus').textContent = `in game, ping: ${Math.max(now - JSON.parse(args), 0).toFixed(1)}ms`\n      } else if (cmd === 'data') {\n        no_data = 0\n        let obj = null\n        let addBullets = null\n        let oldHealth = {}\n        for (const ship of ships) {\n          oldHealth[ship._id] = ship.health\n        }\n        [obj, ships, addBullets, playerCount, rubber, planetSeed] = JSON.parse(args)\n        for (const ship of ships) {\n          if (oldHealth.hasOwnProperty(ship._id) && oldHealth[ship._id] > ship.health) {\n            bubbles.push({ x: ship.posX, y: ship.posY, alpha: 100, radius: 0.3 * (1 + oldHealth[ship._id] - ship.health) })\n          }\n        }\n        if (self.dead) {\n          self = obj\n          self.dead = false\n          self.highAgility = document.getElementById('perkselect').value.trim() == 'movespeed'\n        } else {\n          if (Math.abs(obj.posX - self.posX) > 0.3) {\n            self.posX = (self.posX + obj.posX) / 2\n            self.velX = (self.velX + obj.velX) / 2\n          }\n          if (Math.abs(obj.posY - self.posY) > 0.3) {\n            self.posY = (self.posY + obj.posY) / 2\n            self.velY = (self.velY + obj.velY) / 2\n          }\n          if (Math.abs(obj.velX - self.velX) > 0.2) {\n            self.velX = obj.velX\n          }\n          if (Math.abs(obj.velY - self.velY) > 0.2) {\n            self.posY = obj.posY\n          }\n          if (!accel && obj.accel !== null) {\n            send_turn = true\n          } else if (accel && obj.accel === null) {\n            send_turn = true\n          } else if (!brake && obj.brake !== null) {\n            send_turn = true\n          } else if (brake && obj.brake === null) {\n            send_turn = true\n          }\n          document.getElementById('yourscore').textContent \n            = document.getElementById('scoreanimation').textContent \n            = document.getElementById('finalscorenum').textContent \n            = obj.score\n          if (obj.score > self.score) {\n            document.getElementById('scoreanimation').style.opacity = '1'\n            document.getElementById('scoreanimation').style.animation = 'none'\n            document.getElementById('scoreanimation').style.animation = ''\n          }\n          self.name = obj.name\n          self.score = obj.score\n          self.dead = obj.dead\n          if (obj.health < self.health) {\n            damageAlpha = 0.8 * (self.health - obj.health)\n            damageGot = performance.now() + (self.health - obj.health) * 700\n            bubbles.push({ x: self.posX, y: self.posY, alpha: 100, radius: 0.3 * (1 + self.health - obj.health) })\n          }\n          self.health = obj.health\n          self.latched = obj.latched\n          self.speedMul = obj.speedMul\n          self.overdrive = obj.overdrive\n        }\n        if (physics.getPlanetSeed() != planetSeed) {\n          physics.setPlanetSeed(planetSeed)\n          planets = physics.getPlanets(self.posX, self.posY)\n        }\n        if (addBullets.length) {\n          bullets = [...bullets, ...addBullets.filter(x => x)]\n        }\n        physics.setPlanetSeed(planetSeed)\n        document.getElementById('playerCountNum').textContent = playerCount\n        document.getElementById('healthbarhealth').style.width = `${Math.ceil(self.health * 200)}px`\n      } else if (cmd === 'leaderboard') {\n        leaderboard = JSON.parse(args)\n        drawLeaderboard()\n      } else if (cmd === 'set_orient') {\n        self.orient = parseFloat(args)\n      } else if (cmd === 'unrecognized') {\n        leaveGame()\n      } else if (cmd === 'defeated') {\n        explosion(self)\n        hideLose()\n        leaveGame()\n        document.getElementById('defeat').style.display = 'inline'\n        document.getElementById('defeatname').style.display = 'inline'\n        document.getElementById('defeatname').innerHTML = args\n      } else if (cmd === 'defeated_collision') {\n        explosion(self)\n        hideLose()\n        leaveGame()\n        document.getElementById('defeatcrash').style.display = 'inline'\n        document.getElementById('defeatname').style.display = 'inline'\n        document.getElementById('defeatname').innerHTML = args\n      } else if (cmd === 'defeated_planet') {\n        explosion(self)\n        hideLose()\n        leaveGame()\n        document.getElementById('defeatplanet').style.display = 'inline'\n      } else if (cmd === 'kill_ship') {\n        const matching = ships.find(ship => ship._id === args)\n        if (matching !== null) {\n          explosion(matching)\n        }\n        ships = ships.filter(ship => ship._id !== args)\n      } else if (cmd === 'remove_ship') {\n        ships = ships.filter(ship => ship._id !== args)\n      } else if (cmd === 'remove_bullet') {\n        bullets = bullets.filter(bullet => bullet._id !== args)\n      } else {\n        console.log('unknown cmd', cmd)\n      }\n    })\n    \n    ws.addEventListener('open', () => {\n      dead = false\n      if (connectTimer !== null) {\n        clearTimeout(connectTimer)\n        connectTimer = null\n      }\n      document.getElementById('onlinestatus').textContent = 'waiting for spawn'\n      ws.send('join')\n      checkSize()\n      pinger = setInterval(() => {\n        if (++no_data > 8 || ws == null) {\n          disconnect()\n          return\n        }\n        ws.send('ping ' + performance.now())\n      }, 500)\n    })\n    \n    ws.addEventListener('close', () => {\n      if (!dead) {\n        disconnect()\n      }\n      dead = true\n    })\n  }\n}\n\nconst leaveGame = () => {\n  if (pinger !== null) {\n    clearInterval(pinger)\n    pinger = null\n  }\n  if (ws !== null) {\n    ws.close()\n  }\n  token = null\n  dead = self.dead = true\n  ws = null\n  inGame = accel = brake = turn_left = turn_right = firing = false\n  damageGot = damageAlpha = 0\n  document.getElementById('onlinestatus').textContent = 'offline'\n  showDialog()\n  checkSize()\n}\n\nconst send = (msg) => {\n  if (token) {\n    ws.send(`${token} ${msg}`)\n  }\n}\n\nconst makeTd = (text) => {\n  const td = document.createElement('td')\n  td.textContent = text\n  return td\n}\n\nconst makeTableRow = (lb) => {\n  const tr = document.createElement('tr')\n  tr.appendChild(makeTd(lb[0]))\n  tr.appendChild(makeTd(lb[1]))\n  return tr\n}\n\nconst drawLeaderboard = () => {\n  const leaderBoardTable = document.getElementById('leaderboard')\n  const newBody = document.createElement('tbody')\n  \n  for (let i = 0; i < Math.min(10, leaderboard.length); ++i) {\n    newBody.appendChild(makeTableRow(leaderboard[i]))\n  }\n\n  leaderBoardTable.replaceChild(newBody, leaderBoardTable.childNodes[0])\n}\n\nconst serverTick = () => {\n  if (!ws || !self) {\n    self.velX *= 0.95\n    self.velY *= 0.95\n    return\n  }\n\n  if (send_turn) {\n    send(`control ${JSON.stringify([self.orient, accel, brake, firing])}`)\n    send_turn = false\n  }\n  \n  if (accel) {\n    physics.accel(self, chron.timeMs() - accelStart)\n  }\n  if (brake) {\n    physics.brake(self)\n  }\n  if (firing && (chron.timeMs() - self.lastFired) >= firingInterval) {\n    physics.recoil(self)\n  }\n  physics.inertia(self)\n  if (!self.latched) {\n    physics.rubberband(self, rubber)\n    planets = physics.getPlanets(self.posX, self.posY)\n    physics.gravityShip(self, planets)\n  }\n\n  for (const ship of ships) {\n    physics.gravityShip(ship, physics.getPlanets(ship.posX, ship.posY))\n  }\n\n  for (const bullet of bullets) {\n    physics.gravityBullet(bullet, physics.getPlanets(bullet.posX, bullet.posY))\n  }\n}\nsetInterval(serverTick, TICK_MS)\n\nconst partialTick = (delta) => {\n  tpf = 1.0 * delta / TICK_MS\n\n  if (!self.latched) {\n    // turning\n    if (turn_left && !turn_right) {\n      self.orient -= turn_left_ramp * TURN_UNIT * tpf\n      turn_left_ramp = Math.min(1, turn_left_ramp + tpf * 0.1)\n      if (self.highAgility) {\n        accelStart = chron.timeMs() / 128 + accelStart * 127 / 128\n      } else {\n        accelStart = chron.timeMs()\n      }\n      send_turn = true\n    } else if (turn_right && !turn_left) {\n      self.orient += turn_right_ramp * TURN_UNIT * tpf\n      turn_right_ramp = Math.min(1, turn_right_ramp + tpf * 0.1)\n      if (self.highAgility) {\n        accelStart = chron.timeMs() / 128 + accelStart * 127 / 128\n      } else {\n        accelStart = chron.timeMs()\n      }\n      send_turn = true\n    }\n  }\n  \n  // interpolate\n  self.posX += tpf * self.velX\n  self.posY += tpf * self.velY\n\n  for (const ship of ships) {\n    ship.posX += tpf * ship.velX\n    ship.posY += tpf * ship.velY\n  }\n  for (const bullet of bullets) {\n    bullet.posX += tpf * bullet.velX\n    bullet.posY += tpf * bullet.velY\n    bullet.dist += tpf * bullet.velocity\n  }\n  bullets = bullets.filter(b => b.dist <= physics.MAX_BULLET_DISTANCE)\n}\n\nconst jouter = document.getElementById('joystickouter')\nconst jbase = document.getElementById('joystickbase')\nconst jstick = document.getElementById('joystick')\n\nconst applyPosition = () => {\n  if (dead || self === null) {\n    return\n  }\n\n  const hjbw = jbase.offsetWidth / 2\n  const hjbh = jbase.offsetHeight / 2\n  let x = (jstick.offsetLeft + (jstick.offsetWidth / 2) - (jbase.offsetLeft + hjbw)) / hjbw * Math.sqrt(2)\n  let y = (jstick.offsetTop + (jstick.offsetHeight / 2) - (jbase.offsetTop + hjbh)) / hjbh * Math.sqrt(2)\n  if (x > 1) x = 1\n  if (x < -1) x = -1\n  if (y > 1) y = 1\n  if (y < -1) y = -1\n\n  const h = Math.hypot(x, y)\n  \n  const willAccel = h > 0.8\n  let shouldUpdateAccelStart = willAccel != accel\n\n  if (!self.latched && h > 0.01) {\n    const angle = Math.atan2(x, -y)\n    shouldUpdateAccelStart |= self.orient != angle\n    self.orient = angle \n  }\n\n  accel = willAccel\n  if (shouldUpdateAccelStart) {\n    accelStart = chron.timeMs()\n    send_turn = true\n  }\n}\n\nconst resetJoystickCenter = () => {\n  jstick.style.top = jbase.offsetTop + (jbase.offsetHeight / 2) - (jstick.offsetHeight / 2) + 'px'\n  jstick.style.left = jbase.offsetLeft + (jbase.offsetWidth / 2) - (jstick.offsetWidth / 2) + 'px'\n  applyPosition()\n}\n\nresetJoystickCenter()\n\njbase.addEventListener('pointerdown', (e) => {\n  jstick.style.left = e.pageX - (jstick.offsetWidth / 2) + 'px'\n  jstick.style.top = e.pageY - (jstick.offsetHeight / 2) + 'px'\n  applyPosition()\n})\n\njbase.addEventListener('pointermove', (e) => {\n  if (e.pressure > 0) {\n    jstick.style.left = e.pageX - (jstick.offsetWidth / 2) + 'px'\n    jstick.style.top = e.pageY - (jstick.offsetHeight / 2) + 'px'\n    applyPosition()\n  }\n})\n\njbase.addEventListener('pointerout', (e) => {\n  e.stopPropagation()\n  e.stopImmediatePropagation()\n})\n\njstick.addEventListener('pointerout', (e) => {\n  e.stopPropagation()\n  e.stopImmediatePropagation()\n})\n\njouter.addEventListener('pointerout', () => {\n  console.log('out')\n  resetJoystickCenter()\n})\n\njouter.addEventListener('pointerup', () => {\n  console.log('up')\n  resetJoystickCenter()\n})\n\ndocument.getElementById('btnfire').addEventListener('pointerdown', () => {\n  firing = true\n  send_turn = true\n})\ndocument.getElementById('btnfire').addEventListener('pointerover', (e) => {\n  if (e.pressure > 0) {\n    firing = true\n    send_turn = true\n  }\n})\n\ndocument.getElementById('btnfire').addEventListener('pointerout', () => {\n  firing = false\n  send_turn = true\n})\ndocument.getElementById('btnfire').addEventListener('pointerup', () => {\n  firing = false\n  send_turn = true\n})\n\ndocument.getElementById('btnbrake').addEventListener('pointerdown', () => {\n  brake = true\n  send_turn = true\n})\ndocument.getElementById('btnbrake').addEventListener('pointerover', (e) => {\n  if (e.pressure > 0) {\n    brake = true\n    send_turn = true\n  }\n})\n\ndocument.getElementById('btnbrake').addEventListener('pointerout', () => {\n  brake = false\n  send_turn = true\n})\ndocument.getElementById('btnbrake').addEventListener('pointerup', () => {\n  brake = false\n  send_turn = true\n})\n\nwindow.addEventListener('keydown', (e) => {\n  if (!token || dead) {\n    return\n  }\n\n  if (e.code == 'KeyW') {\n    accel = true\n    self.accel = accelStart = chron.timeMs()\n    send_turn = true\n  } else if (e.code == 'KeyS') {\n    brake = true\n    send_turn = true\n  } else if (e.code == 'KeyA') {\n    turn_left = true\n  } else if (e.code == 'KeyD') {\n    turn_right = true\n  } else if (e.code == 'Space') {\n    firing = true\n    send_turn = true\n  }\n}, true)\n\nwindow.addEventListener('keyup', (e) => {\n  if (!token || dead) {\n    return\n  }\n\n  if (e.code == 'KeyW') {\n    accel = false\n    self.accel = null\n    send_turn = true\n  } else if (e.code == 'KeyS') {\n    brake = false\n    send_turn = true\n  } else if (e.code == 'KeyA') {\n    turn_left_ramp = 0\n    turn_left = false\n  } else if (e.code == 'KeyD') {\n    turn_right_ramp = 0\n    turn_right = false\n  } else if (e.code == 'KeyZ') {\n    nextZoom(e.shiftKey ? -1 : 1)\n  } else if (e.code == 'Space') {\n    firing = false\n    send_turn = true\n  }\n}, true)\n\nwindow.addEventListener('blur', () => {\n  if (!token || dead) {\n    return\n  }\n\n  accel = false\n  self.accel = null\n  brake = false\n  turn_left = false\n  turn_right = false\n  firing = false\n  send_turn = true\n}, true)\n\nwindow.addEventListener('beforeupload', () => {\n  send('disconnect')\n}, true)\n\nconst drawShip = (ship, scale) => {\n  const cx = ctx.canvas.width / 2\n  const cy = ctx.canvas.height / 2\n\n  const [p1, p2, p3, p4] = geom.getShipPoints(ship)\n  let [x1, y1] = p1\n  let [x2, y2] = p2\n  let [x3, y3] = p3\n  let [x4, y4] = p4\n  let [x0, y0] = [0, 0]\n\n  x0 = cx + (self.posX - ship.posX) * scale\n  x1 = cx + (self.posX - ship.posX + x1) * scale\n  x2 = cx + (self.posX - ship.posX + x2) * scale\n  x3 = cx + (self.posX - ship.posX + x3) * scale\n  x4 = cx + (self.posX - ship.posX + x4) * scale\n\n  y0 = cy + (self.posY - ship.posY) * scale\n  y1 = cy + (self.posY - ship.posY + y1) * scale\n  y2 = cy + (self.posY - ship.posY + y2) * scale\n  y3 = cy + (self.posY - ship.posY + y3) * scale\n  y4 = cy + (self.posY - ship.posY + y4) * scale\n\n  ctx.strokeStyle = '#fff'\n  ctx.beginPath()\n  ctx.moveTo(x1, y1)\n  ctx.lineTo(x2, y2)\n  ctx.lineTo(x3, y3)\n  ctx.lineTo(x4, y4)\n  ctx.lineTo(x1, y1)\n  ctx.stroke()\n\n  if (ship.accel) {\n    const [tp1, tp2, tp3, tp4, tp5] = geom.getThrusterPoints(ship)\n    let [x1, y1] = tp1\n    let [x2, y2] = tp2\n    let [x3, y3] = tp3\n    let [x4, y4] = tp4\n    let [x5, y5] = tp5\n\n    let xo = (Math.random() - 0.5) * scale / 4\n    let yo = (Math.random() - 0.5) * scale / 4\n\n    x1 = cx + (self.posX - ship.posX + x1) * scale\n    x2 = cx + (self.posX - ship.posX + x2) * scale\n    x3 = cx + (self.posX - ship.posX + x3) * scale\n    x4 = cx + (self.posX - ship.posX + x4) * scale\n    x5 = cx + (self.posX - ship.posX + x5) * scale\n  \n    y1 = cy + (self.posY - ship.posY + y1) * scale\n    y2 = cy + (self.posY - ship.posY + y2) * scale\n    y3 = cy + (self.posY - ship.posY + y3) * scale\n    y4 = cy + (self.posY - ship.posY + y4) * scale\n    y5 = cy + (self.posY - ship.posY + y5) * scale\n\n    x3 += xo\n    y3 += yo\n    x5 += xo / 2\n    y5 += yo / 2  \n\n    ctx.strokeStyle = '#888'\n    ctx.beginPath()\n    ctx.moveTo(x1, y1)\n    ctx.lineTo(x2, y2)\n    ctx.lineTo(x3, y3)\n    ctx.lineTo(x4, y4)\n    ctx.lineTo(x1, y1)\n    ctx.lineTo(x5, y5)\n    ctx.stroke()\n  }\n\n  ctx.font = '18px monospace'\n  ctx.fillStyle = 'rgba(255,255,255,0.75)'\n  ctx.textAlign = 'center'\n  ctx.fillText(ship.name, x0, y0 - 2.75 * scale)\n}\n\nconst drawBullet = (bullet, scale) => {\n  const cx = ctx.canvas.width / 2\n  const cy = ctx.canvas.height / 2\n\n  const x = cx + (self.posX - bullet.posX) * scale\n  const y = cy + (self.posY - bullet.posY) * scale\n\n  ctx.fillStyle = '#fff'\n  ctx.beginPath()\n  ctx.arc(x, y, 0.2 * scale, 0, 2 * Math.PI)\n  ctx.fill()\n}\n\nconst drawLine = (line, scale) => {\n  const { x, y, angle, r, alpha } = line\n  const cx = ctx.canvas.width / 2\n  const cy = ctx.canvas.height / 2\n\n  const x1 = cx + scale * (x + self.posX - line.xr - r * Math.cos(angle))\n  const y1 = cy + scale * (y + self.posY - line.yr - r * Math.sin(angle))\n  const x2 = cx + scale * (x + self.posX - line.xr + r * Math.cos(angle))\n  const y2 = cy + scale * (y + self.posY - line.yr + r * Math.sin(angle))\n\n  ctx.strokeStyle = `rgba(192,192,192,${alpha * 0.01})` \n  ctx.beginPath()\n  ctx.moveTo(x1, y1)\n  ctx.lineTo(x2, y2)\n  ctx.stroke()\n}\n\nconst drawSmoke = (smoke, scale) => {\n  const { x, y, radius, alpha } = smoke\n  const cx = ctx.canvas.width / 2\n  const cy = ctx.canvas.height / 2\n\n  const sx = cx + (self.posX - x) * scale\n  const sy = cy + (self.posY - y) * scale\n\n  ctx.fillStyle = `rgba(92,92,92,${alpha * 0.01})` \n  ctx.beginPath()\n  ctx.arc(sx, sy, radius * scale, 0, 2 * Math.PI)\n  ctx.fill()\n}\n\nconst drawBubble = (bubble, scale) => {\n  const { x, y, radius, alpha } = bubble\n  const cx = ctx.canvas.width / 2\n  const cy = ctx.canvas.height / 2\n\n  const sx = cx + (self.posX - x) * scale\n  const sy = cy + (self.posY - y) * scale\n\n  ctx.strokeStyle = `rgba(128,128,128,${alpha * 0.01})` \n  ctx.beginPath()\n  ctx.arc(sx, sy, radius * scale, 0, 2 * Math.PI)\n  ctx.stroke()\n}\n\nconst createLine = (x1, y1, x2, y2, xr, yr, xv, yv) => {\n  const [x, y] = [(x1 + x2) / 2, (y1 + y2) / 2]\n  const angle = Math.atan2(x2 - x1, y2 - y1)\n  const r = Math.hypot(x2 - x1, y2 - y1) / 2\n  const vx = -0.05 + 0.1 * Math.random() - xv * tpf\n  const vy = -0.05 + 0.1 * Math.random() - yv * tpf\n  const vangle = -0.1 + 0.2 * Math.random()\n\n  // x, y, xr, yr, angle, r, alpha, vx, vy, vangle\n  return { x, y, xr, yr, angle, alpha: 100, r, vx, vy, vangle }\n}\n\nconst computePlanetAngle = (planet, angle, scale, cx, cy) => {\n  const x = planet.x + Math.sin(angle) * planet.radius\n  const y = planet.y + Math.cos(angle) * planet.radius\n\n  return [cx + (self.posX - x) * scale, cy + (self.posY - y) * scale]\n}\n\nconst drawPlanet = (planet, scale) => {\n  const cx = ctx.canvas.width / 2\n  const cy = ctx.canvas.height / 2\n  ctx.strokeStyle = '#fff'\n  ctx.lineWidth = 1\n\n  lcg.reseed(planet.seed)\n  const gon = Math.abs(lcg.randomInt()) % 24 + 14\n\n  let angle = lcg.randomOffset() * Math.PI * 2 + planetAngle * \n    (2 * (lcg.randomInt() & 1) - 1)\n  let [x, y] = computePlanetAngle(planet, angle, scale, cx, cy)\n\n  ctx.beginPath()\n  ctx.moveTo(x, y)\n  for (let i = 0; i < gon; ++i) {\n    angle += (2 * Math.PI) / gon;\n    [x, y] = computePlanetAngle(planet, angle, scale, cx, cy)\n    ctx.lineTo(x, y)\n  }\n  ctx.stroke()\n}\n\nconst explosion = (ship) => {\n  if (!ship) {\n    return\n  }\n\n  const [p1, p2, p3, p4] = geom.getShipPoints(ship)\n  let [x1, y1] = p1\n  let [x2, y2] = p2\n  let [x3, y3] = p3\n  let [x4, y4] = p4\n\n  let [x5, y5] = [(x1 + x2) / 2, (y1 + y2) / 2]\n  let [x6, y6] = [(x1 + x4) / 2, (y1 + y4) / 2]\n\n  lines.push(createLine(x1, y1, x5, y5, \n    ship.posX, ship.posY, ship.velX, ship.velY))\n  lines.push(createLine(x5, y5, x2, y2, \n    ship.posX, ship.posY, ship.velX, ship.velY))\n  lines.push(createLine(x2, y2, x3, y3, \n    ship.posX, ship.posY, ship.velX, ship.velY))\n  lines.push(createLine(x3, y3, x4, y4, \n    ship.posX, ship.posY, ship.velX, ship.velY))\n  lines.push(createLine(x4, y4, x6, y6, \n    ship.posX, ship.posY, ship.velX, ship.velY))\n  lines.push(createLine(x6, y6, x1, y1, \n    ship.posX, ship.posY, ship.velX, ship.velY))\n}\n\nconst frame = (time) => {\n  ctx.canvas.width = window.innerWidth\n  ctx.canvas.height = window.innerHeight\n  const cx = ctx.canvas.width / 2\n  const cy = ctx.canvas.height / 2\n  const unitSize = Math.min(ctx.canvas.width, ctx.canvas.height) \n    / physics.VIEW_DISTANCE * (zoom / 2)\n\n  let delta = 0\n  if (last_partial != null) {\n    delta = time - last_partial\n    partialTick(delta)\n    if (dialogOpacity < 1) {\n      dialogOpacity = Math.min(1, dialogOpacity + delta / 250)\n      document.getElementById('dialogbox').style.opacity = dialogOpacity\n    }\n  }\n  last_partial = time\n\n  const xm = ((self.posX % GRID_SIZE) + GRID_SIZE) % GRID_SIZE\n  const ym = ((self.posY % GRID_SIZE) + GRID_SIZE) % GRID_SIZE\n\n  ctx.fillStyle = '#000'\n  ctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height)\n\n  // draw grid\n  ctx.lineWidth = 1\n  ctx.strokeStyle = '#333'\n  for (let x = xm * unitSize; \n    x < ctx.canvas.width; \n    x += GRID_SIZE * unitSize) {\n    ctx.beginPath()\n    const dx = x | 0 + 0.5\n    ctx.moveTo(dx, 0)\n    ctx.lineTo(dx, ctx.canvas.height)\n    ctx.stroke()\n  }\n  for (let y = ym * unitSize; \n    y < ctx.canvas.height;\n    y += GRID_SIZE * unitSize) {\n    ctx.beginPath()\n    const dy = y | 0 + 0.5\n    ctx.moveTo(0, dy)\n    ctx.lineTo(ctx.canvas.width, dy)\n    ctx.stroke()\n  }\n  \n  if (!self.dead) {\n    // draw red mask\n    const gradient = ctx.createRadialGradient(cx + self.posX * unitSize,\n      cy + self.posY * unitSize,\n      (rubber - 1) * unitSize,\n      cx + self.posX * unitSize,\n      cy + self.posY * unitSize,\n      (rubber + physics.RUBBERBAND_BUFFER - 1) * unitSize)\n    gradient.addColorStop(0, 'rgba(192,192,192,0)')\n    gradient.addColorStop(1, 'rgba(192,192,192,0.25)')\n    ctx.beginPath()\n    ctx.arc(cx + self.posX * unitSize, cy + self.posY * unitSize, \n      rubber * unitSize, 0, 2 * Math.PI)\n    ctx.rect(ctx.canvas.width, 0, -ctx.canvas.width, ctx.canvas.height)\n    ctx.fillStyle = gradient\n    ctx.fill()\n\n    // draw player ship\n    ctx.lineWidth = 1.5\n    drawShip(self, unitSize)\n    if (self.health < 0.75) {\n      const interval = 320 ** (self.health * 0.35 + 0.9) / 2 / (1 + Math.hypot(self.velX, self.velY) / 6)\n      if (!lastSmoke.hasOwnProperty(self._id) || time - lastSmoke[self._id] > interval) {\n        smokes.push({ \n          x: self.posX + 1.5 * Math.random() - 0.75, \n          y: self.posY + 1.5 * Math.random() - 0.75, \n          radius: 0.15 + (0.75 - self.health) + Math.random() * 0.3, \n          alpha: 100 * Math.min(1, 1.4 - self.health) })\n        lastSmoke[self._id] = time\n      }\n    }\n\n    // draw ships\n    ctx.lineWidth = 1\n    for (const ship of ships) {\n      drawShip(ship, unitSize)\n      if (ship.health < 0.75) {\n        const interval = 320 ** (ship.health * 0.35 + 0.9) / 2 / (1 + Math.hypot(ship.velX, ship.velY) / 6)\n        if (!lastSmoke.hasOwnProperty(ship._id) || time - lastSmoke[ship._id] > interval) {\n          smokes.push({ \n            x: ship.posX + 1.5 * Math.random() - 0.75, \n            y: ship.posY + 1.5 * Math.random() - 0.75, \n            radius: 0.15 + (0.75 - ship.health) + Math.random() * 0.3, \n            alpha: 100 * Math.min(1, 1.4 - ship.health) })\n          lastSmoke[ship._id] = time\n        }\n      }\n    }\n\n    // draw bullets\n    for (const bullet of bullets) {\n      drawBullet(bullet, unitSize)\n    }\n  }\n\n  // draw planets\n  for (const planet of planets) {\n    drawPlanet(planet, unitSize)\n  }\n\n  // draw lines\n  for (const line of lines) {\n    drawLine(line, unitSize)\n\n    line.x += line.vx\n    line.y += line.vy\n    line.angle += line.vangle\n    line.vx *= 0.99\n    line.vy *= 0.99\n    line.vangle *= 0.99\n    line.alpha -= 1\n  }\n  lines = lines.filter(line => line.alpha > 0)\n\n  // draw smokes\n  for (const smoke of smokes) {\n    drawSmoke(smoke, unitSize)\n\n    smoke.radius += 0.015\n    smoke.alpha -= 1\n  }\n  smokes = smokes.filter(smoke => smoke.alpha > 0)\n\n  for (const shipid of Object.keys(lastSmoke)) {\n    if (time - lastSmoke[shipid] >= 5000) {\n      delete lastSmoke[shipid]\n    }\n  }\n\n  // draw bubbles\n  for (const bubble of bubbles) {\n    drawBubble(bubble, unitSize)\n\n    bubble.radius += 0.05\n    bubble.alpha -= 1\n  }\n  bubbles = bubbles.filter(bubble => bubble.alpha > 0)\n\n  if (!self.dead) {\n    // draw black mask\n    const bgradient = ctx.createRadialGradient(cx, cy,\n      (physics.VIEW_DISTANCE - 1) * unitSize,\n      cx, cy,\n      (physics.VIEW_DISTANCE + 10) * unitSize)\n    bgradient.addColorStop(0, 'rgba(0,0,0,0)')\n    bgradient.addColorStop(0.5, 'rgba(0,0,0,0.2)')\n    bgradient.addColorStop(1, 'rgba(0,0,0,0.9)')\n    ctx.beginPath()\n    ctx.arc(cx, cy, \n      (physics.VIEW_DISTANCE - 1) * unitSize, 0, 2 * Math.PI)\n    ctx.rect(ctx.canvas.width, 0, -ctx.canvas.width, ctx.canvas.height)\n    ctx.fillStyle = bgradient\n    ctx.fill()\n\n    if (damageAlpha > 0) {\n      ctx.beginPath()\n      ctx.fillStyle = `rgba(128,0,0,${damageAlpha})`\n      ctx.rect(0, 0, ctx.canvas.width, ctx.canvas.height)\n      ctx.fill()\n      if (time > damageGot && damageAlpha > 0) {\n        damageAlpha = Math.max(0, damageAlpha - delta / 800)\n      }\n    }\n  }\n\n  if (self.health < 0.3) {\n    document.getElementById('yourscore').style.color = (time % 1000) >= 500 ? '#f00' : '#fff'\n    document.getElementById('healthbarhealth').style.background = ((time + 250) % 1000) >= 500 ? '#800' : '#c00'\n  } else if (self.health < 0.7) {\n    document.getElementById('yourscore').style.color = '#fff'\n    const t = (self.health - 0.3) / 0.4 * 204\n    document.getElementById('healthbarhealth').style.background = `rgba(204,${t},${t})`\n  } else {\n    document.getElementById('yourscore').style.color = '#fff'\n    document.getElementById('healthbarhealth').style.background = '#ccc'\n  }\n\n  planetAngle += PLANET_SPIN_SPEED\n  planetAngle %= 2 * Math.PI\n  \n  window.requestAnimationFrame(frame)\n}\n\nconst tryReadCookies = () => {\n  const name = Cookies.get('avaruuspeli-name')\n  if (name) {\n    document.getElementById('nick').value = name.substring(0, 20).trim()\n  }\n  const perk = Cookies.get('avaruuspeli-perk')\n  if (perk) {\n    document.getElementById('perkselect').value = ''\n    for (let i = 0; i < document.getElementById('perkselect').options.length; ++i) {\n      const option = document.getElementById('perkselect').options[i];\n      if (option.value == perk) {\n        option.selected = true\n        break\n      }\n    }\n  }\n  const cookieZoom = Cookies.get('avaruuspeli-zoom') | 0\n  if (isFinite(cookieZoom)) {\n    zoom = ZOOM_LEVELS[(cookieZoom + 1) % ZOOM_LEVELS.length]\n    nextZoom(-1)\n  }\n}\n\ndocument.getElementById('btnplay').addEventListener('click', () => joinGame())\ndocument.getElementById('btnfs').addEventListener('click', () => {\n  if (document.fullscreenElement) {\n    document.exitFullscreen()\n  } else {\n    document.documentElement.requestFullscreen()\n  }\n})\ndocument.getElementById('btnzoom').addEventListener('click', () => nextZoom(1))\n\nwindow.requestAnimationFrame(frame)\n\nleaveGame()\ntryReadCookies()\nshowDialog()\nhideLose()\n","/*!\n * JavaScript Cookie v2.2.0\n * https://github.com/js-cookie/js-cookie\n *\n * Copyright 2006, 2015 Klaus Hartl & Fagner Brack\n * Released under the MIT license\n */\n;(function (factory) {\n\tvar registeredInModuleLoader = false;\n\tif (typeof define === 'function' && define.amd) {\n\t\tdefine(factory);\n\t\tregisteredInModuleLoader = true;\n\t}\n\tif (typeof exports === 'object') {\n\t\tmodule.exports = factory();\n\t\tregisteredInModuleLoader = true;\n\t}\n\tif (!registeredInModuleLoader) {\n\t\tvar OldCookies = window.Cookies;\n\t\tvar api = window.Cookies = factory();\n\t\tapi.noConflict = function () {\n\t\t\twindow.Cookies = OldCookies;\n\t\t\treturn api;\n\t\t};\n\t}\n}(function () {\n\tfunction extend () {\n\t\tvar i = 0;\n\t\tvar result = {};\n\t\tfor (; i < arguments.length; i++) {\n\t\t\tvar attributes = arguments[ i ];\n\t\t\tfor (var key in attributes) {\n\t\t\t\tresult[key] = attributes[key];\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\tfunction init (converter) {\n\t\tfunction api (key, value, attributes) {\n\t\t\tvar result;\n\t\t\tif (typeof document === 'undefined') {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Write\n\n\t\t\tif (arguments.length > 1) {\n\t\t\t\tattributes = extend({\n\t\t\t\t\tpath: '/'\n\t\t\t\t}, api.defaults, attributes);\n\n\t\t\t\tif (typeof attributes.expires === 'number') {\n\t\t\t\t\tvar expires = new Date();\n\t\t\t\t\texpires.setMilliseconds(expires.getMilliseconds() + attributes.expires * 864e+5);\n\t\t\t\t\tattributes.expires = expires;\n\t\t\t\t}\n\n\t\t\t\t// We're using \"expires\" because \"max-age\" is not supported by IE\n\t\t\t\tattributes.expires = attributes.expires ? attributes.expires.toUTCString() : '';\n\n\t\t\t\ttry {\n\t\t\t\t\tresult = JSON.stringify(value);\n\t\t\t\t\tif (/^[\\{\\[]/.test(result)) {\n\t\t\t\t\t\tvalue = result;\n\t\t\t\t\t}\n\t\t\t\t} catch (e) {}\n\n\t\t\t\tif (!converter.write) {\n\t\t\t\t\tvalue = encodeURIComponent(String(value))\n\t\t\t\t\t\t.replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g, decodeURIComponent);\n\t\t\t\t} else {\n\t\t\t\t\tvalue = converter.write(value, key);\n\t\t\t\t}\n\n\t\t\t\tkey = encodeURIComponent(String(key));\n\t\t\t\tkey = key.replace(/%(23|24|26|2B|5E|60|7C)/g, decodeURIComponent);\n\t\t\t\tkey = key.replace(/[\\(\\)]/g, escape);\n\n\t\t\t\tvar stringifiedAttributes = '';\n\n\t\t\t\tfor (var attributeName in attributes) {\n\t\t\t\t\tif (!attributes[attributeName]) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tstringifiedAttributes += '; ' + attributeName;\n\t\t\t\t\tif (attributes[attributeName] === true) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tstringifiedAttributes += '=' + attributes[attributeName];\n\t\t\t\t}\n\t\t\t\treturn (document.cookie = key + '=' + value + stringifiedAttributes);\n\t\t\t}\n\n\t\t\t// Read\n\n\t\t\tif (!key) {\n\t\t\t\tresult = {};\n\t\t\t}\n\n\t\t\t// To prevent the for loop in the first place assign an empty array\n\t\t\t// in case there are no cookies at all. Also prevents odd result when\n\t\t\t// calling \"get()\"\n\t\t\tvar cookies = document.cookie ? document.cookie.split('; ') : [];\n\t\t\tvar rdecode = /(%[0-9A-Z]{2})+/g;\n\t\t\tvar i = 0;\n\n\t\t\tfor (; i < cookies.length; i++) {\n\t\t\t\tvar parts = cookies[i].split('=');\n\t\t\t\tvar cookie = parts.slice(1).join('=');\n\n\t\t\t\tif (!this.json && cookie.charAt(0) === '\"') {\n\t\t\t\t\tcookie = cookie.slice(1, -1);\n\t\t\t\t}\n\n\t\t\t\ttry {\n\t\t\t\t\tvar name = parts[0].replace(rdecode, decodeURIComponent);\n\t\t\t\t\tcookie = converter.read ?\n\t\t\t\t\t\tconverter.read(cookie, name) : converter(cookie, name) ||\n\t\t\t\t\t\tcookie.replace(rdecode, decodeURIComponent);\n\n\t\t\t\t\tif (this.json) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tcookie = JSON.parse(cookie);\n\t\t\t\t\t\t} catch (e) {}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (key === name) {\n\t\t\t\t\t\tresult = cookie;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!key) {\n\t\t\t\t\t\tresult[name] = cookie;\n\t\t\t\t\t}\n\t\t\t\t} catch (e) {}\n\t\t\t}\n\n\t\t\treturn result;\n\t\t}\n\n\t\tapi.set = api;\n\t\tapi.get = function (key) {\n\t\t\treturn api.call(api, key);\n\t\t};\n\t\tapi.getJSON = function () {\n\t\t\treturn api.apply({\n\t\t\t\tjson: true\n\t\t\t}, [].slice.call(arguments));\n\t\t};\n\t\tapi.defaults = {};\n\n\t\tapi.remove = function (key, attributes) {\n\t\t\tapi(key, '', extend(attributes, {\n\t\t\t\texpires: -1\n\t\t\t}));\n\t\t};\n\n\t\tapi.withConverter = init;\n\n\t\treturn api;\n\t}\n\n\treturn init(function () {});\n}));\n","const GRAV = 6.67e-11\nconst TICKS_PER_SECOND = 20\nconst MAX_SHIP_VELOCITY = 48 / TICKS_PER_SECOND\nconst MIN_SHIP_VELOCITY = 0.01\nconst LATCH_VELOCITY = 0.2\nconst BULLET_VELOCITY = MAX_SHIP_VELOCITY * 1.75\nconst BRAKE_MUL = (MIN_SHIP_VELOCITY / MAX_SHIP_VELOCITY) ** (1 / (TICKS_PER_SECOND * 1.5))\nconst INERTIA_MUL = 1\n// (MIN_SHIP_VELOCITY / MAX_SHIP_VELOCITY) ** (1 / (TICKS_PER_SECOND * 90))\nconst VIEW_DISTANCE = 50\nconst MAX_BULLET_DISTANCE = 50\nconst DELAY_BETWEEN_BULLETS_MS = 200\nconst RUBBERBAND_BUFFER = 80\nconst LCG = require('./utils/lcg')\nconst PLANET_CHUNK_SIZE = VIEW_DISTANCE * 1.6 + 1\n\nlet PLANET_SEED = 1340985553\n\nconst getAccelMul = (accelTimeMs) => { // time in milliseconds\n  return 0.05 + 0.000025 * accelTimeMs\n}\n\nconst checkMinVelocity = (ship) => {\n  const v = Math.hypot(ship.velX, ship.velY)\n  if (v <= MIN_SHIP_VELOCITY) {\n    ship.velX = 0\n    ship.velY = 0\n  }\n}\n\nconst checkMaxVelocity = (ship) => {\n  const maxvel = MAX_SHIP_VELOCITY * healthToVelocity(ship.health)\n  const v = Math.hypot(ship.velX, ship.velY) * ship.speedMul\n  if (v > maxvel) {\n    ship.velX *= maxvel / v\n    ship.velY *= maxvel / v\n  }\n}\n\nconst getPlanetSeed = () => {\n  return PLANET_SEED\n}\n\nconst setPlanetSeed = (seed) => {\n  PLANET_SEED = seed\n}\n\nconst newPlanetSeed = () => {\n  PLANET_SEED = Math.floor(Math.random() * 2147483647)\n}\n\n// planet: x, y, radius, seed\nconst getPlanetsForChunk = (cx, cy) => {\n  const r = PLANET_CHUNK_SIZE\n  const lcg = new LCG((PLANET_SEED ^ (cx * 1173320513) ^ (cy * 891693747)) & 0xFFFFFFFF)\n  const xb = (cx + 0.5) * r\n  const yb = (cy + 0.5) * r\n  \n  const xo = lcg.randomOffset() * (r / 4)\n  const yo = lcg.randomOffset() * (r / 4)\n  const radius = (r / 24) + (r / 8) * lcg.random()\n  const seed = lcg.randomInt()\n  return [ { x: xb + xo, y: yb + yo, radius, seed } ]\n}\n\nconst getPlanets = (x, y) => {\n  const x0 = Math.floor(x / PLANET_CHUNK_SIZE)\n  const y0 = Math.floor(y / PLANET_CHUNK_SIZE)\n\n  const xu = [x0 - 2, x0 - 1, x0, x0 + 1, x0 + 2]\n  const yu = [y0 - 2, y0 - 1, y0, y0 + 1, y0 + 2]\n  let planets = []\n\n  for (const x of xu) {\n    for (const y of yu) {\n      planets = [...planets, ...getPlanetsForChunk(x, y)]\n    }\n  }\n  \n  return planets\n}\n\nconst accel = (ship, accelTimeMs) => {\n  let accelMul = getAccelMul(accelTimeMs) * healthToVelocity(ship.health)\n  if (ship.speedMul !== 1) {\n    accelMul *= Math.sqrt(ship.speedMul)\n  }\n  ship.velX += accelMul * Math.sin(-ship.orient)\n  ship.velY += accelMul * Math.cos(-ship.orient)\n  checkMaxVelocity(ship)\n}\n\nconst inertia = (ship) => {\n  ship.velX *= INERTIA_MUL\n  ship.velY *= INERTIA_MUL\n  checkMinVelocity(ship)\n}\n\nconst brake = (ship) => {\n  ship.velX *= BRAKE_MUL\n  ship.velY *= BRAKE_MUL\n  checkMinVelocity(ship)\n}\n\nconst recoil = (ship) => {\n  ship.velX -= 0.02 * Math.sin(-ship.orient)\n  ship.velY -= 0.02 * Math.cos(-ship.orient)\n  checkMaxVelocity(ship)\n}\n\nconst gravityBullet = (bullet, planets) => {\n  for (const planet of planets) {\n    const d = Math.hypot(bullet.posX - planet.x, bullet.posY - planet.y)\n    if (d > (planet.radius + 1.2) && d < planet.radius * 3) {\n      const dx = planet.x - bullet.posX\n      const dy = planet.y - bullet.posY\n      const r2 = Math.hypot(dx, dy) ** 2\n      const f = GRAV * 8e+9 / r2 * planet.radius\n      bullet.velX += f * dx\n      bullet.velY += f * dy\n    }\n  }\n  const d = Math.hypot(bullet.velX, bullet.velY)\n  bullet.velX *= bullet.velocity / d\n  bullet.velY *= bullet.velocity / d\n}\n\nconst gravityShip = (ship, planets) => {\n  for (const planet of planets) {\n    const d = Math.hypot(ship.posX - planet.x, ship.posY - planet.y)\n    if (d > (planet.radius + 1) && d < planet.radius * 3) {\n      const dx = planet.x - ship.posX\n      const dy = planet.y - ship.posY\n      const r2 = Math.hypot(dx, dy) ** 2\n      const f = GRAV * 8e+8 * planet.radius / r2 / (\n        (ship.accel !== null || ship.brake !== null) ? 5 : 1)\n      ship.velX += f * dx\n      ship.velY += f * dy\n    }\n  }\n  checkMaxVelocity(ship)\n}\n\nconst getRubberbandRadius = (playerCount) => {\n  return 75 * Math.pow(Math.max(playerCount, 1), 0.75)\n}\n\nconst rubberband = (ship, radius) => {\n  const distCenter = Math.hypot(ship.posX, ship.posY)\n  if (distCenter > radius) {\n    const maxRadius = radius + RUBBERBAND_BUFFER\n    const baseX = -ship.posX / Math.hypot(ship.posX, ship.posY)\n    const baseY = -ship.posY / Math.hypot(ship.posX, ship.posY)\n    if (distCenter > maxRadius) {\n      ship.velX = ship.velY = 0\n    }\n    ship.velX += baseX * 0.3 * MAX_SHIP_VELOCITY *\n      (1.1 * (distCenter - radius) / (maxRadius - radius)) ** 8\n    ship.velY += baseY * 0.3 * MAX_SHIP_VELOCITY *\n      (1.1 * (distCenter - radius) / (maxRadius - radius)) ** 8\n    checkMaxVelocity(ship)\n  }\n}\n\nconst healthToVelocity = (health) => {\n  return 0.6 + 0.4 * Math.pow(health, 1.5)\n}\n\nmodule.exports = {\n  TICKS_PER_SECOND,\n  MAX_SHIP_VELOCITY,\n  BULLET_VELOCITY,\n  LATCH_VELOCITY,\n  VIEW_DISTANCE,\n  MAX_BULLET_DISTANCE,\n  DELAY_BETWEEN_BULLETS_MS,\n  RUBBERBAND_BUFFER,\n  accel,\n  inertia,\n  brake,\n  recoil,\n  gravityBullet,\n  gravityShip,\n  rubberband,\n  getPlanets,\n  getPlanetSeed,\n  setPlanetSeed,\n  newPlanetSeed,\n  getRubberbandRadius,\n  healthToVelocity }\n","const timeMs = () => new Date().getTime()\n\nmodule.exports = { timeMs }\n","const EPSILON = 1e-10\n\nconst pointInTriangle = (p1, p2, p3, p) => {\n  const [x1, y1] = p1\n  const [x2, y2] = p2\n  const [x3, y3] = p3\n  const [xp, yp] = p\n\n  const c1 = ((y2 - y3) * (xp - x3) + (x3 - x2) * (yp - y3)) \n           / ((y2 - y3) * (x1 - x3) + (x3 - x2) * (y1 - y3))\n  const c2 = ((y3 - y1) * (xp - x3) + (x1 - x3) * (yp - y3)) \n           / ((y2 - y3) * (x1 - x3) + (x3 - x2) * (y1 - y3))\n  const c3 = 1 - c1 - c2\n  return c1 > 0 && c2 > 0 && c3 > 0\n}\n\nconst handleZeroEpsilon = (x) => {\n  return Math.abs(x) < EPSILON ? 0 : x\n}\n\nconst pointOrientation = (p, q, r) => {\n  return Math.sign(handleZeroEpsilon(\n    (p[0] - q[0]) * (r[1] - q[1])\n    - (p[1] - q[1]) * (r[0] - q[0])))\n}\n\nconst onCollinearSegment = (p, q, r) => {\n  return (q[0] <= Math.max(p[0], r[0])) && (q[0] >= Math.min(p[0], r[0]))\n    && (q[1] <= Math.max(p[1], r[1])) && (q[1] >= Math.min(p[1], r[1]))\n}\n\nconst lineIntersectsLine = (a1, a2, b1, b2) => {\n  const o1 = pointOrientation(a1, b1, a2)\n  const o2 = pointOrientation(a1, b1, b2)\n  const o3 = pointOrientation(a2, b2, a1)\n  const o4 = pointOrientation(a2, b2, b1)\n\n  return (o1 !== o2 && o3 !== o4)\n    || (o1 == 0 && onCollinearSegment(a1, a2, b1))\n    || (o2 == 0 && onCollinearSegment(a1, b2, b1))\n    || (o3 == 0 && onCollinearSegment(a2, a1, b2))\n    || (o4 == 0 && onCollinearSegment(a2, b1, b2))\n}\n\nconst lineIntersectsTriangle = (l1, l2, t1, t2, t3) => {\n  return lineIntersectsLine(l1, l2, t1, t2)\n    || lineIntersectsLine(l1, l2, t2, t3)\n    || lineIntersectsLine(l1, l2, t3, t1)\n}\n\nconst closestSynchroDistance = (a1, a2, b1, b2) => {\n  const A = a1[0] - b1[0]\n  const B = (a2[0] - a1[0]) - (b2[0] - b1[0])\n  const C = a1[1] - b1[1]\n  const D = (a2[1] - a1[1]) - (b2[1] - b1[1])\n  if (B == 0 && D == 0) {\n    return 0\n  }\n  return -(A * B + C * D) / (B * B + D * D)\n}\n\nconst wrapRadianAngle = (angle) => {\n  return (angle + Math.PI) % (2 * Math.PI) - Math.PI\n}\n\nconst getPlanetAngleMultiplier = (orient, vel) => {\n  let diff = Math.abs((orient - vel + Math.PI) % (2 * Math.PI))\n  if (Math.abs(diff) > Math.PI) {\n    diff = (2 * Math.PI) - Math.PI\n  }\n  const sc = diff / Math.PI\n  return 1 + sc\n}\n\nconst rotatePoint = (s, c, x, y) => [x * c - y * s, x * s + y * c]\n\nconst rotatePointOffset = (s, c, x, y, xo, yo) => \n  [xo + x * c - y * s, yo + x * s + y * c]\n\nconst getShipPoints = (ship) => {\n  if (!ship) {\n    return []\n  }\n\n  const s = Math.sin(ship.orient)\n  const c = Math.cos(ship.orient)\n\n  return [\n    rotatePoint(s, c,  0   , -1   ),\n    rotatePoint(s, c, +1   , +1.5 ),\n    rotatePoint(s, c,  0   , +1   ),\n    rotatePoint(s, c, -1   , +1.5 )\n  ]\n}\n\nconst getOffsetShipPoints = (ship, x, y) => {\n  if (!ship) {\n    return []\n  }\n\n  const points = getShipPoints(ship)\n  return [\n    [points[0][0] + x, points[0][1] + y],\n    [points[1][0] + x, points[1][1] + y],\n    [points[2][0] + x, points[2][1] + y],\n    [points[3][0] + x, points[3][1] + y]\n  ]\n}\n\nconst getRealShipPoints = (ship) => {\n  return getOffsetShipPoints(ship, ship.posX, ship.posY)\n}\n\nconst getCollisionPoints = (ship) => {\n  if (!ship) {\n    return []\n  }\n\n  const s = Math.sin(ship.orient)\n  const c = Math.cos(ship.orient)\n  \n  return [\n    rotatePointOffset(s, c,  0   , +1   , ship.posX, ship.posY),\n    rotatePointOffset(s, c, +0.67, -1   , ship.posX, ship.posY),\n    rotatePointOffset(s, c, -0.67, -1   , ship.posX, ship.posY)\n  ]\n}\n\nconst getThrusterPoints = (ship) => {\n  if (!ship) {\n    return []\n  }\n\n  const s = Math.sin(ship.orient)\n  const c = Math.cos(ship.orient)\n\n  return [\n    rotatePoint(s, c,  0   , +1   ),\n    rotatePoint(s, c, +0.5 , +1.25),\n    rotatePoint(s, c,  0   , +2.5 ),\n    rotatePoint(s, c, -0.5 , +1.25),\n    rotatePoint(s, c,  0   , +1.75),\n  ]\n}\n\nmodule.exports = { \n  pointInTriangle,\n  lineIntersectsLine,\n  closestSynchroDistance,\n  lineIntersectsTriangle,\n  wrapRadianAngle,\n  getPlanetAngleMultiplier,\n  getShipPoints,\n  getOffsetShipPoints,\n  getRealShipPoints,\n  getCollisionPoints,\n  getThrusterPoints }\n","const LCG_A = 535426113\nconst LCG_C = 2258250855\n\nclass Generator {\n  constructor(seed) {\n    this.seed = seed & 0xFFFFFFFF\n  }\n\n  reseed(seed) {\n    this.seed = seed & 0xFFFFFFFF\n  }\n\n  randomInt() {\n    const val = this.seed\n    this.seed = (LCG_A * val + LCG_C) & 0xFFFFFFFF\n    return val\n  }\n\n  random() {\n    let v = this.randomInt() / (2.0 ** 32)\n    if (v < 0) {\n      v += 1\n    }\n    return v\n  }\n\n  randomOffset() {\n    return 2 * this.random() - 1\n  }\n}\n\nmodule.exports = Generator\n"],"sourceRoot":""}